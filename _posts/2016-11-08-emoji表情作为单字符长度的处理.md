---
layout:     post
title:      emojiè¡¨æƒ…ä½œä¸ºå•å­—ç¬¦é•¿åº¦çš„å¤„ç†
date:       2016-11-08 08:08:08
summary:    Wellcome To My Blog.
categories: study
thumbnail: cogs
tags:
 - emoji
 - é•¿åº¦
 - emojiè¡¨æƒ…ä½œä¸ºå•å­—ç¬¦é•¿åº¦çš„å¤„ç†
---

æˆ‘ä»¬çŸ¥é“emojiè¡¨æƒ…æ˜¯ä¸€äº›ç‰¹æ®Šæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è®¡ç®—å…¶é•¿åº¦çš„æ—¶å€™ç›´æ¥ç”¨â€œxxx.lengthâ€å³å¯ï¼Œä½†æœ‰æ—¶å€™äº§å“ç»ç†ä¼šè¦æ±‚ä½ æŠŠæ‰€æœ‰çš„emojiè¡¨æƒ…éƒ½å½“åšä¸€ä¸ªå­—ç¬¦å¤„ç†ï¼Œåˆ«é—®æˆ‘æ€ä¹ˆçŸ¥é“çš„ğŸ˜­ğŸ˜­ğŸ˜­ï¼Œè¿™é‡Œå†™ä¸‹æ¥å¸Œæœ›å¤§å®¶ä¸è¦è·Ÿæˆ‘ä¸€æ ·åˆ°å¤„è·³å‘

è¿˜æ˜¯ç›´æ¥ä¸Šä»£ç 

1.è·å–emojiä¸ªæ•°ï¼ˆæˆ‘è¿™é‡Œå†™åˆ°äº†NSStringçš„ç±»æ–¹æ³•ä¸­ï¼‰

	+ (NSInteger)emojiCountInString:(NSString *)string
	{
	    __block NSInteger num = 0;
	    [string enumerateSubstringsInRange:NSMakeRange(0, [string length])
	                               options:NSStringEnumerationByComposedCharacterSequences
	                            usingBlock:^(NSString * _Nullable substring, NSRange substringRange, NSRange enclosingRange, BOOL * _Nonnull stop) {
			const unichar hs = [substring characterAtIndex:0];
			if (0xd800 <= hs && hs <= 0xdbff){
				if (substring.length > 1) {
					const unichar ls = [substring characterAtIndex:1];
				    const int uc = ((hs - 0xd800) * 0x400) + (ls - 0xdc00) + 0x10000;
					if (0x1d000 <= uc && uc <= 0x1f918)
					{
						num += 1;
					}
				}
			}
			else if (substring.length > 1)
			{
				const unichar ls = [substring characterAtIndex:1];
				if (ls == 0x20e3 || ls == 0xFE0F || ls == 0xd83c)
				{
					num += 1;
				}
			}
		    else{
			// non surrogate
				if (0x2100 <= hs && hs <= 0x27ff)
				{
				if (0x278b <= hs && 0x2792 >= hs)
				{
					//ä¸ä¸ºemoji
				}
				else
				{
					num += 1;
				}
			}
			else if (0x2B05 <= hs && hs <= 0x2b07)
			{
				num += 1;
			}
			else if (0x2934 <= hs && hs <= 0x2935)
			{
				num += 1;
			}
			else if (0x3297 <= hs && hs <= 0x3299)
			{
				num += 1;
			}
			else if (hs == 0xa9 || hs == 0xae || hs == 0x303d || hs == 0x3030 || hs == 0x2b55 || hs == 0x2b1c || hs == 0x2b1b || hs == 0x2b50 || hs == 0xd83e)
			{
				num += 1;
			}
		}
		}];
	    return num;
	}


2.å­—ç¬¦ä¸²å»æ‰emoji

	+ (NSString *)getStringWithoutEmoji:(NSString *)string
	{
	    __block NSString *tempStr = string;
	    [string enumerateSubstringsInRange:NSMakeRange(0, [string length])
	                               options:NSStringEnumerationByComposedCharacterSequences
	                            usingBlock:^(NSString * _Nullable substring, NSRange substringRange, NSRange enclosingRange, BOOL * _Nonnull stop) {
	                                const unichar hs = [substring characterAtIndex:0];
	                                // surrogate pair
	                                if (0xd800 <= hs && hs <= 0xdbff)
	                                {
	                                    if (substring.length > 1)
	                                    {
	                                        const unichar ls = [substring characterAtIndex:1];
	                                        const int uc = ((hs - 0xd800) * 0x400) + (ls - 0xdc00) + 0x10000;
	                                        if (0x1d000 <= uc && uc <= 0x1f918)
	                                        {
	
	                                            tempStr = [tempStr stringByReplacingOccurrencesOfString:substring withString:@""];
	                                        }
	                                    }
	                                }
	                                else if (substring.length > 1)
	                                {
	                                    const unichar ls = [substring characterAtIndex:1];
	                                    if (ls == 0x20e3 || ls == 0xFE0F || ls == 0xd83c)
	                                    {
	                                        tempStr = [tempStr stringByReplacingOccurrencesOfString:substring withString:@""];
	                                    }
	                                }
	                                else
	                                {
	                                    // non surrogate
	                                    if (0x2100 <= hs && hs <= 0x27ff)
	                                    {
	                                        if (0x278b <= hs && 0x2792 >= hs)
	                                        {
	                                            //ä¸ä¸ºemoji
	                                        }
	                                        else
	                                        {
	                                            tempStr = [tempStr stringByReplacingOccurrencesOfString:substring withString:@""];
	                                        }
	                                    }
	                                    else if (0x2B05 <= hs && hs <= 0x2b07)
	                                    {
	                                        tempStr = [tempStr stringByReplacingOccurrencesOfString:substring withString:@""];
	                                    }
	                                    else if (0x2934 <= hs && hs <= 0x2935)
	                                    {
	                                        tempStr = [tempStr stringByReplacingOccurrencesOfString:substring withString:@""];
	                                    }
	                                    else if (0x3297 <= hs && hs <= 0x3299)
	                                    {
	                                        tempStr = [tempStr stringByReplacingOccurrencesOfString:substring withString:@""];
	                                    }
	                                    else if (hs == 0xa9 || hs == 0xae || hs == 0x303d || hs == 0x3030 || hs == 0x2b55 || hs == 0x2b1c || hs == 0x2b1b || hs == 0x2b50 || hs == 0xd83e)
	                                    {
	                                        tempStr = [tempStr stringByReplacingOccurrencesOfString:substring withString:@""];
	                                    }
	                                }
	                            }];
	    return tempStr;
	}

3.è·å–æŠŠemojiè¡¨æƒ…å½“æˆå•ä¸ªå­—ç¬¦é•¿åº¦å¤„ç†åçš„å­—ç¬¦ä¸²é•¿åº¦

	-(NSInteger)lengthWithEmojiString{
	    NSInteger emojiLen = [NSString emojiCountInString:self];
	    NSString * normalStr = [NSString getStringWithoutEmoji:self];
	    NSInteger strLengh = normalStr.length+emojiLen;
	    return strLengh;
	}













