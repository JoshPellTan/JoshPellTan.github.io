<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>è°­å¥</title>
    <description>æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººç½‘ç«™~</description>
    <link>/</link>
    <atom:link href="/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 26 May 2017 15:10:02 +0800</pubDate>
    <lastBuildDate>Fri, 26 May 2017 15:10:02 +0800</lastBuildDate>
    <generator>Jekyll v3.1.1</generator>
    
      <item>
        <title>è‡ªå®šä¹‰è¡¨è§†å›¾åˆ·æ–°å’ŒåŠ è½½æ§ä»¶</title>
        <description>&lt;p&gt;å¬ä¼ è¨€è¯´å…¬å¸å‡†å¤‡ä½¿ç”¨è‡ªå®šä¹‰çš„ä¸Šæ‹‰å’Œä¸‹æ‹‰æ§ä»¶ï¼Œä»¥å‰ç ”ç©¶è¿‡ï¼Œä½†æ²¡æœ‰ç”¨åˆ°å®é™…é¡¹ç›®ä¸­ï¼Œä¸ç®¡ä¼ è¨€æ˜¯çœŸæ˜¯å‡ï¼Œé‡æ–°å­¦ä¹ ï¼Œç»§ç»­è¿›æ­¥ï¼è¿™é‡Œä¹Ÿè´´å‡ºæˆ‘å†™çš„&lt;a href=&quot;https://github.com/JoshPellTan/TJRefresh&quot;&gt;DEMO&lt;/a&gt;ï¼Œæ¬¢è¿ä½¿ç”¨å’ŒStarï¼&lt;/p&gt;

&lt;p&gt;åˆ·æ–°å’ŒåŠ è½½æ§ä»¶åŸç†æ˜¯ä¸€æ ·ï¼Œè¿™é‡Œå°±åªè®²åˆ·æ–°æ§ä»¶ï¼Œæˆ‘ä»¬å…ˆä¸å»ç ”ç©¶æ•ˆæœï¼Œå…ˆæ¥åˆ†æä¸€ä¸‹åŠŸèƒ½å®ç°ï¼Œä¸€ä¸ªå¸¸ç”¨çš„åˆ·æ–°æ§ä»¶å·¥ä½œåˆ†ä»¥ä¸‹å‡ æ­¥ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;1.æ‹–åŠ¨è¡¨è§†å›¾ä¸‹æ‹‰ï¼Œæ§ä»¶è·Ÿéšæ»‘åŠ¨è§†å›¾æ…¢æ…¢å‡ºç°&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;2.æ»‘åŠ¨åˆ°é™å®šè·ç¦»ï¼Œç›´æ¥æ¾æ‰‹å°±è§¦å‘åˆ·æ–°åŠ¨ä½œï¼Œå¼€å§‹åˆ·æ–°ï¼Œåˆ·æ–°æ•ˆæœåœç•™é¡¶ç«¯ï¼›è‹¥æœªæ¾æ‰‹ç»§ç»­æ»‘åŠ¨åˆ°é™å®šè·ç¦»ä»¥å†…ï¼Œä¸æ‰§è¡Œæ“ä½œ&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;3.åˆ·æ–°å®Œæˆï¼Œå»æ‰åˆ·æ–°æ•ˆæœï¼Œè§†å›¾æ¢å¤åŸä½&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;section&quot;&gt;æ·»åŠ æ§ä»¶åˆ°æ¯ä¸ªæ»‘åŠ¨è§†å›¾&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆå¦‚æœæ˜¯ç»™ä¸€ä¸ªæˆç†Ÿçš„é¡¹ç›®åŠ ä¸Šåˆ·æ–°æ§ä»¶ï¼Œä¸å¯èƒ½åœ¨æ¯ä¸ªæœ‰æ»‘åŠ¨è§†å›¾çš„ç±»ä¸­éƒ½å»æ·»åŠ åˆ·æ–°æ§ä»¶ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿæ»‘åŠ¨è§†å›¾éƒ½æœ‰ä¸ªå…±åŒç‚¹ï¼Œéƒ½ç»§æ‰¿è‡ª&lt;code class=&quot;highlighter-rouge&quot;&gt;UIScroolView&lt;/code&gt;ï¼Œæ‰€ä»¥è¿™é‡Œå’±ä»¬é‡‡ç”¨ç»™&lt;code class=&quot;highlighter-rouge&quot;&gt;UIScroolView&lt;/code&gt;ç±»æ–°å»ºä¸€ä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;TJRefresher&lt;/code&gt;çš„åˆ†ç±»ï¼Œå†ç»™åˆ†ç±»æ·»åŠ å’±ä»¬éœ€è¦çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;header&lt;/code&gt;å’Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;footer&lt;/code&gt;å±æ€§ï¼Œå†åœ¨æˆ‘ä»¬éœ€è¦çš„æ»‘åŠ¨è§†å›¾ç±»ä¸­è°ƒç”¨è¿™ä¸¤ä¸ªå±æ€§å³å¯ã€‚ä½†æ˜¯åˆ†ç±»ä¸­æ˜¯ä¸èƒ½ç›´æ¥æ·»åŠ å±æ€§çš„ï¼Œå’‹åŠï¼Œç›´æ¥ä¸è¡Œæ¥é—´æ¥å‘—ï¼Œè¿™é‡Œå°±è¦ç”¨åˆ°è¿è¡Œæ—¶äº†ï¼Œå‰é¢è®²è¿‡&lt;a href=&quot;https://joshpelltan.github.io/2016/12/RunTimeåŠ¨æ€æ·»åŠ æ–¹æ³•å’Œå±æ€§/&quot;&gt;å¦‚ä½•åŠ¨æ€æ·»åŠ å±æ€§&lt;/a&gt;ï¼Œè¿™é‡Œä¸å†ç»†è®²ã€‚ä¸Šä»£ç ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;static const void *TJRefreshHeaderKey = &amp;amp;TJRefreshHeaderKey;

- (void)setHeader:(TJRefreshHeader *)header {
    
    if (self.header != header) {
        [self.header removeFromSuperview];
        [self insertSubview:header atIndex:0];
        
    }
    objc_setAssociatedObject(self, TJRefreshHeaderKey, header, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}

- (TJRefreshHeader *)header {
    return objc_getAssociatedObject(self, &amp;amp;TJRefreshHeaderKey);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;è¿™é‡Œæˆ‘ç”¨çš„æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;insertSubview: atIndex:&lt;/code&gt;æ–¹æ³•è€Œä¸æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;addSubview:&lt;/code&gt;ï¼Œä»–ä»¬çš„åŒºåˆ«æ˜¯å‰è€…æ˜¯å°†è§†å›¾æ’å…¥åŒä¸€ä¸ªå±‚çº§ï¼Œå¹¶ä¸”å¯ä»¥æ’é˜Ÿï¼Œè€Œåè€…åªèƒ½æ˜¯ä¸€å±‚ä¸€å±‚å¾€ä¸Šå ã€‚å½“ä¸€ä¸ªæ»‘åŠ¨è§†å›¾åŒæ—¶æ·»åŠ åˆ·æ–°å’ŒåŠ è½½æ§ä»¶æ—¶ï¼Œå‰è€…å¯ä»¥ä¿è¯ä»–ä»¬æ˜¯åœ¨ä¸€ä¸ªè§†å›¾å±‚çº§ï¼Œæ–¹ä¾¿ç»Ÿä¸€å¤„ç†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;section-1&quot;&gt;ç›‘å¬æ»‘åŠ¨è§†å›¾ï¼Œæ”¹å˜æ§ä»¶çŠ¶æ€&lt;/h3&gt;

&lt;p&gt;è¿™é‡Œéœ€è¦ä½¿ç”¨KVOç›‘å¬æ»‘åŠ¨è§†å›¾çš„æ»‘åŠ¨è·ç¦»ï¼Œæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€ä¸ªæ˜¯æ”¾åœ¨ä¸Šé¢çš„åˆ†ç±»ä¸­å®ç°ï¼Œå¦ä¸€ä¸ªæ˜¯æ”¾åœ¨åˆ·æ–°æ§ä»¶ç±»ä¸­å®ç°ã€‚å‰è€…éœ€è¦åˆ·æ–°æ§ä»¶æš´éœ²å¾ˆå¤šæ–¹æ³•å’Œå±æ€§ä¾›å¤–éƒ¨è°ƒç”¨ï¼Œåè€…åªéœ€è¦å°†å½“å‰æ»‘åŠ¨è§†å›¾ä¼ é€’ç»™åˆ·æ–°æ§ä»¶ç±»è¿›è¡Œæ“ä½œå³å¯ï¼Œæƒè¡¡åé€‰åè€…ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆé‡å†™&lt;code class=&quot;highlighter-rouge&quot;&gt;UIView&lt;/code&gt;ç±»çš„æ–¹æ³•ï¼Œå°†æ»‘åŠ¨è§†å›¾å–åˆ°å½“å‰ç±»æš‚å­˜ï¼Œå¹¶æ ¹æ®è¯¥è§†å›¾è°ƒæ•´æ§ä»¶çš„ä½ç½®ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;- (void)willMoveToSuperview:(UIView *)newSuperview {
    [super willMoveToSuperview:newSuperview];
    
    if (newSuperview &amp;amp;&amp;amp; [newSuperview isKindOfClass:[UIScrollView class]]) {
        
        [self removeObserver];
        self.scrollView = (UIScrollView *)newSuperview;
        self.center = CGPointMake(self.scrollView.bounds.size.width*0.5, -TJRefreshPullLen*0.5);
       
        [self addObserver];
    }else {
        [self removeObserver];
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;è¿™é‡Œæ·»åŠ KVOæ—¶æ·»åŠ äº†ä¸¤ä¸ªå±æ€§ç›‘å¬ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;contentOffset&lt;/code&gt;å’Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;contentSize&lt;/code&gt;ï¼Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨åˆ·æ–°æ§ä»¶ä¸­å…¶å®åªéœ€è¦ç›‘å¬å‰è€…å³å¯ï¼Œåè€…çš„ç›‘å¬æ˜¯åœ¨åšåŠ è½½æ§ä»¶çš„æ—¶å€™ï¼Œéœ€è¦æ ¹æ®çˆ¶æ»‘åŠ¨è§†å›¾çš„å†…å®¹å¤§å°æ¥ç¡®å®šæ§ä»¶ä½ç½®å’Œè®¡ç®—æ§ä»¶æ‰€åœ¨çŠ¶æ€ã€‚è¿™ä¹Ÿæ˜¯ä¸¤ä¸ªæ§ä»¶æœ€å¤§çš„ä¸åŒã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[self.scrollView addObserver:self forKeyPath:@&quot;contentOffset&quot; options:NSKeyValueObservingOptionNew context:nil];
    [self.scrollView addObserver:self forKeyPath:@&quot;contentSize&quot; options:NSKeyValueObservingOptionNew context:nil];
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;æ¥ä¸‹æ¥å°†ç›‘å¬åˆ°çš„åç§»å€¼è¿›è¡Œå¤„ç†ï¼Œå°äºæé™å€¼ä»€ä¹ˆéƒ½ä¸åšï¼Œå¤§äºæé™å€¼æ—¶æ¾æ‰‹åˆ™è¿›è¡Œåˆ·æ–°æ“ä½œï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CGFloat value = (layerStrokenValue-(TJRefreshPullLen-TJRefreshHeaderHeight)*0.5)/((TJRefreshPullLen+TJRefreshHeaderHeight)*0.5);

//å¦‚æœä¸æ˜¯æ­£åœ¨åˆ·æ–°ï¼Œåˆ™æ¸å˜åŠ¨ç”»
if (!self.animating) {
    
    self.draftShapeLayer.strokeEnd = value;
    self.squareShapeLayer.strokeEnd = value;
    self.lineShapeLayer1.strokeEnd = value*2;
    self.lineShapeLayer2.strokeEnd = (value-0.5)*2;
    self.wordsShapeLayer.strokeEnd = value;

}
//å¦‚æœåˆ°è¾¾ä¸´ç•Œç‚¹ï¼Œåˆ™æ‰§è¡Œåˆ·æ–°åŠ¨ç”»
if (value &amp;gt; 1 &amp;amp;&amp;amp; !self.animating &amp;amp;&amp;amp; !self.scrollView.dragging){
    [self startAnimation];
    if (self.handle) {
        self.handle();
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;è¿™é‡Œæ§ä»¶éœ€è¦æš´éœ²ä¸€ä¸ªæ–¹æ³•åœ¨åˆ·æ–°ç»“æŸæ—¶ä¾›æ»‘åŠ¨è§†å›¾è°ƒç”¨ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;- (void)endRefreshing {
    
    [self stopAnimation];
    NSLog(@&quot;ç»“æŸåˆ·æ–°&quot;);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;ui&quot;&gt;åŠ è½½æ§ä»¶çš„UI&lt;/h3&gt;

&lt;p&gt;è¿™é‡Œæˆ‘ä»¿äº†ä¸€ä¸ªä»Šæ—¥å¤´æ¡çš„åˆ·æ–°æ§ä»¶æ•ˆæœï¼Œç”¨åˆ°äº†iOS9å’Œswift3.0åæ‰æ¨å‡ºçš„&lt;code class=&quot;highlighter-rouge&quot;&gt;CAShapeLayer&lt;/code&gt;ï¼Œç»“åˆ&lt;code class=&quot;highlighter-rouge&quot;&gt;UIBezierPath&lt;/code&gt;ç»˜åˆ¶å‡ºäº†å›¾å½¢çš„çº¿æ¡å’Œè·¯å¾„ï¼Œå†é€šè¿‡ä¸Šé¢çš„æ»‘åŠ¨ç›‘å¬å»æ§åˆ¶çº¿æ¡é¢œè‰²çš„å¡«å……ç™¾åˆ†æ¯”ã€‚è¿™ä¸€æ­¥éª¤æ²¡æœ‰å¤ªå¤æ‚çš„é€»è¾‘ï¼Œç†Ÿæ‚‰ä¸Šé¢ä¸¤ä¸ªç±»çš„ä½¿ç”¨å³å¯ï¼Œä¸ç»†è®²ï¼Œæœ‰å…´è¶£å¯ä»¥ç ”ç©¶&lt;a href=&quot;https://github.com/JoshPellTan/TJRefresh&quot;&gt;demo&lt;/a&gt;ã€‚æˆ‘è¿˜æ·»åŠ äº†ä¸€ä¸ªæ–‡å­—è½¬è´å¡å°”æ›²çº¿çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç ”ç©¶ä¸€ä¸‹ã€‚&lt;/p&gt;

&lt;p&gt;åˆ°è¿™é‡Œä¸€ä¸ªåˆ·æ–°æ§ä»¶å°±å®šåˆ¶å®Œæˆäº†ï¼Œåªè´´å‡ºäº†ä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹çš„ä»£ç ï¼ŒåŠ è½½æ§ä»¶æ·»åŠ ä¹Ÿç±»ä¼¼ã€‚è¿™é‡Œåªå®ç°äº†ä¸€ä¸ªæ•ˆæœï¼ŒåæœŸå¦‚æœç¢°åˆ°äº†å¥½çš„æ•ˆæœï¼Œæˆ‘è¿˜ä¼šç»§ç»­æ·»åŠ çš„ï¼ˆå‰ææ˜¯æˆ‘ä¼šğŸ˜ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;å¹¿å‘Šæ—¶é—´ï¼šè§‰å¾—ä¸é”™ï¼Œæ¬¢è¿&lt;a href=&quot;https://github.com/JoshPellTan/TJRefresh&quot;&gt;Star&lt;/a&gt;ï¼&lt;/p&gt;

</description>
        <pubDate>Thu, 25 May 2017 16:08:13 +0800</pubDate>
        <link>/2017/05/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%BB%91%E5%8A%A8%E8%A7%86%E5%9B%BE%E5%88%B7%E6%96%B0%E5%92%8C%E5%8A%A0%E8%BD%BD%E6%8E%A7%E4%BB%B6/</link>
        <guid isPermaLink="true">/2017/05/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%BB%91%E5%8A%A8%E8%A7%86%E5%9B%BE%E5%88%B7%E6%96%B0%E5%92%8C%E5%8A%A0%E8%BD%BD%E6%8E%A7%E4%BB%B6/</guid>
        
        <category>åˆ·æ–°</category>
        
        <category>åŠ è½½</category>
        
        <category>è‡ªå®šä¹‰æ»‘åŠ¨è§†å›¾åˆ·æ–°å’ŒåŠ è½½æ§ä»¶</category>
        
        
        <category>study</category>
        
      </item>
    
      <item>
        <title>å½•éŸ³ä¸æ’­æ”¾ä»¥åŠç½‘ç»œéŸ³é¢‘æ’­æ”¾</title>
        <description>&lt;p&gt;å…¬å¸ä¸‹ä¸ªç‰ˆæœ¬è®¡åˆ’è¦åšéŸ³é¢‘çš„å½•åˆ¶ä¸æ’­æ”¾ï¼Œè¿™å—æ²¡æ€ä¹ˆæ¥è§¦è¿‡ï¼Œä¸€è¾¹å­¦ä¹ ä¸€è¾¹è¸©å‘ï¼Œä¸‹é¢å°±ç»™å¤§å®¶åšä¸ªåˆ†äº«ï¼Œå…±åŒè¿›æ­¥ã€‚è¿™é‡Œä¹Ÿè´´å‡ºæˆ‘å†™çš„&lt;a href=&quot;https://github.com/JoshPellTan/TJAudioRecorderAndPlayer&quot;&gt;DEMO&lt;/a&gt;ï¼Œæ¬¢è¿ä½¿ç”¨å’Œstarï¼&lt;/p&gt;

&lt;h3 id=&quot;section&quot;&gt;å½•éŸ³&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;éŸ³é¢‘ä»»åŠ¡åˆå§‹åŒ–&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬è¿™é‡Œç”¨çš„æ˜¯NBçš„AVFoundationæ¡†æ¶ï¼Œè¿™é‡Œä½¿ç”¨AudioSessionæ¥å¯¹éŸ³é¢‘ä»»åŠ¡åšå¤„ç†ï¼Œæ— è®ºæ˜¯å½•åˆ¶è¿˜æ˜¯æ’­æ”¾éƒ½éœ€è¦åšè¿™ä¸€æ­¥ã€‚åˆå§‹åŒ–ä»»åŠ¡ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;AVAudioSession *session = [AVAudioSession sharedInstance];
            NSError *sessionError;
[session setCategory:AVAudioSessionCategoryPlayAndRecord error:&amp;amp;sessionError];
if(session == nil){
    NSLog(@&quot;Error creating session: %@&quot;, [sessionError description]);
}else{
    [session setActive:YES error:nil];//æ¿€æ´»å½“å‰session
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;å¦‚æœä¸åšåˆå§‹åŒ–ï¼Œç›´æ¥ä½¿ç”¨AudioRecorderçš„è¯ï¼Œå½•åˆ¶å‡ºæ¥æ˜¯æ²¡æœ‰ä»»ä½•å£°éŸ³çš„ï¼Œä¸‹é¢å‡ ç‚¹å°±æ˜¯åŸå› ï¼Œä¹Ÿæ˜¯å®ƒçš„ä¸»è¦åŠŸèƒ½ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;1.ä¸ºappé€‰æ‹©è¾“å…¥è¾“å‡ºçš„è·¯ç”± ï¼ˆé€šè¿‡æ‰¬å£°å™¨è¿˜æ˜¯å¬ç­’æ’­æ”¾ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;2.åè°ƒéŸ³é¢‘æ’­æ”¾çš„appä¹‹é—´çš„å…³è”ï¼Œä»¥åŠç³»ç»Ÿçš„å£°éŸ³å¤„ç†&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;3.å¤„ç†è¢«å…¶ä»–appsæ‰“æ–­&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;4.åˆ›å»ºä¸€ä¸ªå½•éŸ³æˆ–è€…æ’­æ”¾éŸ³ä¹çš„ä»»åŠ¡&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;è€Œè¿™é‡Œçš„å‚æ•°&lt;code class=&quot;highlighter-rouge&quot;&gt;AVAudioSessionCategoryPlayAndRecord&lt;/code&gt;éœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;* AVAudioSessionCategorySoloAmbient 
  ä¼šåœæ­¢å…¶ä»–ç¨‹åºçš„éŸ³é¢‘æ’­æ”¾ã€‚å½“è®¾å¤‡è¢«è®¾ç½®ä¸ºé™éŸ³æ¨¡å¼ï¼Œappä¹ŸåŒæ ·è¢«åœæ­¢
* AVAudioSessionCategoryRecord
  ä»…ç”¨æ¥å½•éŸ³ï¼Œæ— æ³•æ’­æ”¾éŸ³é¢‘
* AVAudioSessionCategoryPlayback 
 ä¼šåœæ­¢å…¶å®ƒéŸ³é¢‘æ’­æ”¾ï¼Œå¹¶ä¸”èƒ½åœ¨åå°æ’­æ”¾ï¼Œé”å±andé™éŸ³æ¨¡å¼ä¸‹å‡å¯
* AVAudioSessionCategoryPlayAndRecord
  èƒ½æ’­ä¹Ÿèƒ½å½•ï¼Œæ’­æ”¾é»˜è®¤å£°éŸ³æ˜¯ä»å¬ç­’å‡ºæ¥
* AVAudioSessionCategoryAmbient
  appçš„å£°éŸ³å¯ä¸å…¶å®ƒappå…±å­˜ï¼Œä½†é”å±å’Œé™éŸ³æƒ…å†µä¼šè¢«åœæ­¢ï¼Œé™¤éå½“å‰appæ˜¯å”¯ä¸€æ’­æ”¾çš„app
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;åˆå§‹åŒ–å½•éŸ³å™¨&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å½•éŸ³éœ€è¦è°ƒç”¨AVAudioRecorderï¼Œä¸‹é¢ä»£ç ç”¨äºåˆå§‹åŒ–å½•éŸ³å™¨ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NSString *docDir = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) objectAtIndex:0];
playName = [NSString stringWithFormat:@&quot;%@/play.aac&quot;,docDir];
//å½•éŸ³è®¾ç½®
recorderSettingsDict =[[NSDictionary alloc] initWithObjectsAndKeys:
                                   [NSNumber 										numberWithInt:kAudioFormatMPEG4AAC],AVFormatIDKey,
                                   [NSNumber numberWithInt:8000],AVSampleRateKey,
                                   [NSNumber numberWithInt:1],AVNumberOfChannelsKey,
                                   AVAudioQualityHigh,AVEncoderAudioQualityKey,
                                   nil];

NSError *error = nil;
//å¿…é¡»çœŸæœºä¸Šæµ‹è¯•,æ¨¡æ‹Ÿå™¨ä¸Šå¯èƒ½ä¼šå´©æºƒ
_recorder = [[AVAudioRecorder alloc] initWithURL:[NSURL URLWithString:playName] settings:recorderSettingsDict error:&amp;amp;error];
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;å…ˆç»™å¤§å®¶çœ‹ä¸€ä¸‹åˆå§‹åŒ–å­—å…¸é‡Œé¢çš„å‚æ•°ï¼š&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;AVFormatIDKey&lt;/code&gt;â€”â€”éŸ³é¢‘æ ¼å¼ï¼Œä¸»è¦æœ‰ä¸€ä¸‹æ”¯æŒæ ¼å¼ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;kAudioFormatLinearPCM
kAudioFormatMPEG4AAC
kAudioFormatAppleLossless
kAudioFormatAppleMA4
kAudioFormatiLBC
kAudioFormatULaw é€‰æ‹©kAudioFormatLinearPCMä¼šå°†æœªå‹ç¼©çš„éŸ³é¢‘æµå†™å…¥åˆ°æ–‡ä»¶ä¸­.è¿™ç§æ ¼å¼ä¿çœŸåº¦æœ€é«˜,ä¸è¿‡ç›¸åº”çš„æ–‡ä»¶ä¹Ÿæœ€å¤§.é€‰æ‹©è¯¸å¦‚kAudioFormatMPEG4AACæˆ–è€…kAudioFormatAppleMA4çš„å‹ç¼©æ ¼å¼ä¼šæ˜¾è‘—ç¼©å°æ–‡ä»¶,ä¹Ÿèƒ½ä¿è¯é«˜è´¨é‡çš„éŸ³é¢‘å†…å®¹ã€‚æˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯kAudioFormatMPEG4AAC,è€Œä¸”å®‰å“å’Œè‹¹æœéƒ½æ”¯æŒæ’­æ”¾ã€‚
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;AVSampleRateKey&lt;/code&gt;â€”â€”é‡‡æ ·ç‡ï¼Œå•ä½HZï¼Œé‡‡æ ·ç‡è¶Šå°å£°éŸ³è´¨é‡è¶Šä½ï¼Œé€šå¸¸æœ‰8000/44100/96000ï¼Œé‡‡æ ·ç‡å¿…é¡»è¦è®¾ä¸º11025æ‰èƒ½ä½¿è½¬åŒ–æˆmp3æ ¼å¼åä¸ä¼šå¤±çœŸ&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;AVNumberOfChannelsKey&lt;/code&gt;â€”â€”å£°é“æ•°ï¼Œ1æˆ–2ï¼Œé™¤éä½¿ç”¨å¤–éƒ¨ç¡¬ä»¶,å¦åˆ™é€šå¸¸åº”å½“åˆ›å»ºå•å£°é“å½•éŸ³ã€‚é€šå¸¸å•å£°é“è¶³ä»¥æ»¡è¶³æˆ‘ä»¬å½•éŸ³åŠŸèƒ½çš„éœ€è¦ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;AVEncoderAudioQualityKey&lt;/code&gt;â€”â€”å½•éŸ³éŸ³è´¨ï¼Œæ˜¯ä¸€ä¸ªæšä¸¾å€¼ï¼Œè¿™é‡Œæˆ‘é€‰AVAudioQualityHighä¸­ç­‰è´¨é‡ã€‚&lt;/p&gt;

&lt;p&gt;æ›´å¤šå‚è€ƒ&lt;a href=&quot;http://www.jianshu.com/p/135ca0deceec&quot;&gt;é“¾æ¥&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¼€å§‹å½•åˆ¶&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;_recorder.meteringEnabled = YES;//è®¾ç½®yesæ‰èƒ½ç›‘æµ‹è¾“å…¥çš„éŸ³é‡å¤§å°ï¼Œå¯ä»¥ç”¨ä½œç”¨æˆ·ç•Œé¢åé¦ˆ
[_recorder record];
volumeTimer = [NSTimer scheduledTimerWithTimeInterval:volumeObserverMargin target:weakSelf selector:@selector(levelTimer:) userInfo:nil repeats:YES];//æ–°å»ºä¸€ä¸ªè®¡æ—¶å™¨ç”¨ä½œæµ‹é‡éŸ³é‡å¤§å°
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;ç›‘æµ‹éŸ³é‡&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//è¾“å…¥å£°éŸ³çš„åˆ†è´å¤§å°è®¡ç®—
[_recorder updateMeters];
const double ALPHA = 0.05;
double peakPowerForChannel = pow(10, (0.05 * [_recorder peakPowerForChannel:0]));
lowPassResults = ALPHA * peakPowerForChannel + (1.0 - ALPHA) * lowPassResults;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;åœæ­¢å½•éŸ³&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;_recorder stop];
_recorder = nil;
//ç»“æŸå®šæ—¶å™¨
[volumeTimer invalidate];
volumeTimer = nil;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;section-1&quot;&gt;æ’­æ”¾æœ¬åœ°å½•éŸ³&lt;/h3&gt;

&lt;p&gt;è¿™é‡Œåˆ†ä¸¤æ­¥æ“ä½œï¼Œä¸€æ˜¯æ’­æ”¾æœ¬åœ°éŸ³é¢‘ï¼ŒäºŒæ˜¯è¿›è¡Œè¿›åº¦ç›‘å¬&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ’­æ”¾æœ¬åœ°éŸ³é¢‘&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[playerLocal play];
progressTimer = [NSTimer scheduledTimerWithTimeInterval:playerTimeObserverMargin target:self selector:@selector(recorderTimeViewer) userInfo:nil repeats:YES];//æ–°å»ºè®¡æ—¶å™¨ç›‘å¬æ’­æ”¾è¿›åº¦
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;æ’­æ”¾è¿›åº¦ç›‘å¬&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NSLog(@&quot;æ€»æ—¶é•¿ï¼š%f--å½“å‰æ—¶é—´ç‚¹ï¼š%f&quot;,_playerLocal.duration,_playerLocal.currentTime);
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;section-2&quot;&gt;æ’­æ”¾ç½‘ç»œéŸ³é¢‘&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;_songItem = [[AVPlayerItem alloc]initWithURL:url];
_playerNetwork = [[AVPlayer alloc]initWithPlayerItem:_songItem];
[_playerNetwork play];
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;è·å–ç½‘ç»œèµ„æºæ€»æ—¶é•¿çš„æ–¹æ³•ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;netAudioTime = CMTimeGetSeconds(_songItem.asset.duration);
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;tips&quot;&gt;Tips&lt;/h3&gt;

&lt;p&gt;1..plistæ–‡ä»¶ä¸­åŠ å…¥éº¦å…‹é£è¯·æ±‚æƒé™
2.å¦‚æœéœ€è¦æ’­æ”¾ç½‘ç»œéŸ³é¢‘ï¼Œæ·»åŠ &lt;code class=&quot;highlighter-rouge&quot;&gt;App Transport Security Settings&lt;/code&gt;ä¸‹çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;Allow Arbitrary Loads&lt;/code&gt;å¹¶è®¾ç½®ä¸ºYES
3.å¦‚æœéœ€è¦appæ”¯æŒåå°æ’­æ”¾éŸ³é¢‘ï¼Œéœ€è¦æ‰“å¼€&lt;code class=&quot;highlighter-rouge&quot;&gt;Capabilities&lt;/code&gt;ä¸‹é¢&lt;code class=&quot;highlighter-rouge&quot;&gt;Background Modes&lt;/code&gt;ä¸‹é¢çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;Audio,AirPlay,and Picture in Picture&lt;/code&gt;é€‰é¡¹ï¼Œä½†æ˜¯å®¡æ ¸çš„æ—¶å€™è‹¹æœå¦‚æœè®¤ä¸ºä½ æ²¡æœ‰å¿…è¦æ‰“å¼€è¿™ä¸ªåŠŸèƒ½ï¼Œä¼šè¢«æ‹’å“¦ï¼
4.ä¸ç”¨å¤–æ¥è®¾å¤‡å½•éŸ³å’Œæ’­æ”¾ä¼šå£°éŸ³å°ï¼Œè§£å†³åŠæ³•æ˜¯æ’­æ”¾å‰åŠ å…¥ä¸‹é¢ä»£ç ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NSError *audioError = nil;
BOOL success = [audioSession overrideOutputAudioPort:AVAudioSessionPortOverrideSpeaker error:&amp;amp;audioError];
if(!success)
{
NSLog(@&quot;error doing outputaudioportoverride - %@&quot;, [audioError localizedDescription]);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

</description>
        <pubDate>Fri, 19 May 2017 16:08:13 +0800</pubDate>
        <link>/2017/05/%E5%BD%95%E9%9F%B3%E4%B8%8E%E6%92%AD%E6%94%BE%E4%BB%A5%E5%8F%8A%E7%BD%91%E7%BB%9C%E9%9F%B3%E9%A2%91%E6%92%AD%E6%94%BE/</link>
        <guid isPermaLink="true">/2017/05/%E5%BD%95%E9%9F%B3%E4%B8%8E%E6%92%AD%E6%94%BE%E4%BB%A5%E5%8F%8A%E7%BD%91%E7%BB%9C%E9%9F%B3%E9%A2%91%E6%92%AD%E6%94%BE/</guid>
        
        <category>å¤šåª’ä½“</category>
        
        <category>éŸ³é¢‘</category>
        
        <category>å½•éŸ³ä¸æ’­æ”¾ä»¥åŠç½‘ç»œéŸ³é¢‘æ’­æ”¾</category>
        
        
        <category>study</category>
        
      </item>
    
      <item>
        <title>ç¼–ç¨‹æ€æƒ³å°è§‘</title>
        <description>&lt;p&gt;æœ€è¿‘åœ¨ç ”ç©¶RAC,å‘ç°ç¼–ç¨‹æ€æƒ³è¿™ä¸€ä¸ªå¾ˆæœ‰è¶£ä¸”æœ‰ç”¨çš„ä¸œè¥¿ï¼Œå°±å¤§æ¦‚ç ”ç©¶äº†ä¸€ä¸‹â€œé“¾å¼ç¼–ç¨‹â€ã€â€œå‡½æ•°å¼ç¼–ç¨‹â€ã€â€œå“åº”å¼ç¼–ç¨‹â€å‡ ç§ä¸»è¦çš„ç¼–ç¨‹æ€æƒ³ï¼Œå‘ç°å¯¹æé«˜ä»£ç è´¨é‡å’Œä¸šåŠ¡æ°´å¹³å¾ˆæœ‰å¸®åŠ©ï¼Œä¸‹é¢å°±æŒ¨ä¸ªä»‹ç»ä¸€ä¸‹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥çœ‹æˆ‘çš„&lt;a href=&quot;https://github.com/JoshPellTan/ThinkingInPerl.git&quot;&gt;DEMO&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;section&quot;&gt;é“¾å¼ç¼–ç¨‹&lt;/h3&gt;

&lt;h4 id=&quot;section-1&quot;&gt;&lt;em&gt;æ€æƒ³ç‰¹ç‚¹&lt;/em&gt;ï¼š&lt;/h4&gt;
&lt;p&gt;æ˜¯å°†å¤šä¸ªæ“ä½œï¼ˆå¤šè¡Œä»£ç ï¼‰é€šè¿‡ç‚¹å·(.)é“¾æ¥åœ¨ä¸€èµ·æˆä¸ºä¸€å¥ä»£ç ,ä½¿ä»£ç å¯è¯»æ€§å¥½ã€‚ç±»ä¼¼a(1).b(2).c(3)ï¼Œæ–¹æ³•çš„è¿”å›å€¼æ˜¯block,blockå¿…é¡»æœ‰è¿”å›å€¼ï¼ˆæœ¬èº«å¯¹è±¡ï¼‰ï¼Œblockå‚æ•°ï¼ˆéœ€è¦æ“ä½œçš„å€¼ï¼‰&lt;/p&gt;

&lt;h4 id=&quot;section-2&quot;&gt;&lt;em&gt;ä»£è¡¨&lt;/em&gt;ï¼š&lt;/h4&gt;
&lt;p&gt;masonryæ¡†æ¶ã€SDAutoLayoutæ¡†æ¶ã€‚&lt;/p&gt;

&lt;h4 id=&quot;demo&quot;&gt;&lt;em&gt;demo&lt;/em&gt;:&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;TJChainedModeClass *chainedMode1 = [TJChainedModeClass new];
chainedMode1.addName(@&quot;jackson&quot;).addNickname(@&quot;josh&quot;).addAge(5).addHeadImg(nil);
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;å…¶ä¸­&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;chainedMode1.addName(@&quot;jackson&quot;).addNickname(@&quot;josh&quot;).addAge(5).addHeadImg(nil);
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;æ¯ä¸€æ­¥ç‚¹æ“ä½œéƒ½ä¼šè¿”å›ä¸€ä¸ªTJChainedModeClasså®ä¾‹å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ç›´æ¥è°ƒå–ä¸‹ä¸€ä¸ªç‚¹å±æ€§æ“ä½œ&lt;/p&gt;

&lt;p&gt;è¿™é‡Œè´´å‡ºä¸€ä¸ªç‚¹æ“ä½œå‡½æ•°ï¼Œå…¶ä»–çš„éƒ½æ˜¯ç±»ä¼¼å½¢å¼&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;typedef TJChainedModeClass *(^configerString)(NSString *string);//è¿™é‡Œçš„configerStringæ˜¯åœ¨.hæ–‡ä»¶ä¸­å®šä¹‰çš„è¿”å›å€¼ä¸ºæœ¬ç±»å¯¹è±¡çš„ä¸€ä¸ªblock,æ”¾è¿™é‡Œæ–¹ä¾¿æŸ¥çœ‹

-(configerString)addName{
    
    if (!_addName) {
        
        __weak typeof(self) weakSelf = self;
        return ^(NSString *string){
            
            weakSelf.name = string;
            return weakSelf;
        };
    }
    
    return _addName;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;section-3&quot;&gt;å“åº”å¼ç¼–ç¨‹&lt;/h3&gt;

&lt;h4 id=&quot;section-4&quot;&gt;&lt;em&gt;æ€æƒ³ç‰¹ç‚¹&lt;/em&gt;ï¼š&lt;/h4&gt;
&lt;p&gt;ä¸éœ€è¦è€ƒè™‘è°ƒç”¨é¡ºåºï¼Œåªéœ€è¦çŸ¥é“è€ƒè™‘ç»“æœï¼Œç±»ä¼¼äºè´è¶æ•ˆåº”ï¼Œäº§ç”Ÿä¸€ä¸ªäº‹ä»¶ï¼Œä¼šå½±å“å¾ˆå¤šä¸œè¥¿ï¼Œè¿™äº›äº‹ä»¶åƒæµä¸€æ ·çš„ä¼ æ’­å‡ºå»ï¼Œç„¶åå½±å“ç»“æœï¼Œå€Ÿç”¨é¢å‘å¯¹è±¡çš„ä¸€å¥è¯ï¼Œä¸‡ç‰©çš†æ˜¯æµã€‚æ˜¯æŠŠæ“ä½œå°½é‡å†™æˆä¸€ç³»åˆ—åµŒå¥—çš„å‡½æ•°æˆ–è€…æ–¹æ³•è°ƒç”¨ã€‚
#### &lt;em&gt;ä»£è¡¨&lt;/em&gt;ï¼š
KVOè¿ç”¨ã€ReactiveCocoa(ä¹Ÿåšå‡½æ•°å“åº”å¼ç¼–ç¨‹)ã€‚&lt;/p&gt;

&lt;h4 id=&quot;demo-1&quot;&gt;&lt;em&gt;demo&lt;/em&gt;&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;è¿™é‡Œæˆ‘é€‰ç”¨KVOçš„æ–¹å¼æ¥å®ç°ï¼Œå…¶å®æ–¹æ³•å¾ˆå¤šï¼Œå¯ä»¥å‚è€ƒRACã€‚æˆ‘è¿™é‡Œæ˜¯ç»™æœ¬ç±»çš„reactNumæ·»åŠ å±æ€§ç›‘å¬ï¼Œæœ‰æ”¹å˜å¤–éƒ¨è°ƒç”¨çš„åœ°æ–¹ä¹Ÿä¼šæ‰§è¡Œblockï¼Œè€Œå¦å¤–ä¸€ä¸ªå±æ€§normalNumçš„æ”¹å˜åˆ™ä¸ä¼šå¼•èµ·è¿™ç§æ”¹å˜
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;.hä¸­ä»£ç :&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nonatomic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assign&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reactNum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nonatomic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assign&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;normalNum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nonatomic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;copy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reactBlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;.må®ç°:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-(instancetype)init{
    self = [super init];
    
    [self addObserver:self forKeyPath:@&quot;reactNum&quot; options:NSKeyValueObservingOptionNew context:nil];
    
    return self;
}

-(void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&amp;lt;NSKeyValueChangeKey,id&amp;gt; *)change context:(void *)context{
    
    self.reactBlock(self.normalNum,self.reactNum);
    
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;è°ƒç”¨ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-(void)reactProgramming{
    
    //ç±»ä¸­çš„reactNumæ•°å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè°ƒç”¨æ‰“å°æ–¹æ³•
    TJReactiveProgrammingClass *reactObj = [TJReactiveProgrammingClass new];
    _reactObj = reactObj;
    
    //[reactObj TJ_addObserver:self forKeyPath:@&quot;reactNum&quot; options:NSKeyValueObservingOptionNew  context:nil];
    reactObj.reactBlock = ^(int normalNum,int reactNum){
        
        NSLog(@&quot;normalNum:%d----reactNum:%d&quot;,normalNum,reactNum);
        
    };
}
//ç‚¹å‡»æµ‹è¯•æ•ˆæœ
-(void)touchesBegan:(NSSet&amp;lt;UITouch *&amp;gt; *)touches withEvent:(UIEvent *)event{
    
    _reactObj.reactNum = arc4random() % 100;//æ”¹å˜æ—¶ä¼šå“åº”
    //_reactObj.normalNum = arc4random() % 100;//æ”¹å˜æ—¶ä¸ä¼šå“åº”
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;section-5&quot;&gt;å‡½æ•°å¼ç¼–ç¨‹&lt;/h3&gt;

&lt;p&gt;ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿå‡½æ•°å¼ç¼–ç¨‹åœ¨iOSä¸­æ˜¯å€Ÿç”±blockå®ç°çš„ï¼Œé€šè¿‡å£°æ˜ä¸€ä¸ªblockï¼Œç±»ä¼¼äºå®šä¹‰äº†ä¸€ä¸ªâ€œå‡½æ•°â€ï¼Œå†å°†è¿™ä¸ªâ€œå‡½æ•°â€ä¼ é€’ç»™è°ƒç”¨çš„æ–¹æ³•ï¼Œä»¥æ­¤æ¥å®ç°å¯¹è°ƒç”¨è¯¥æ–¹æ³•æ—¶ä¸­é—´ä¸€äº›è¿‡ç¨‹æˆ–è€…å¯¹ç»“æœå¤„ç†çš„â€œè‡ªå®šä¹‰â€ï¼Œè€Œå…¶å†…éƒ¨çš„å…¶ä»–ç¯èŠ‚å®Œå…¨ä¸éœ€è¦æš´éœ²ç»™è°ƒç”¨è€…ã€‚å®é™…ä¸Šï¼Œè°ƒç”¨è€…ä¹Ÿæ ¹æœ¬ä¸éœ€è¦çŸ¥é“ã€‚&lt;/p&gt;

&lt;p&gt;å’±ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[self.playBtn mas_makeConstraints:^(MASConstraintMaker *make) {
        make.center.equalTo(self.picView);
        make.width.height.mas_equalTo(50);
    }];
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;ä»ä¸­å¯ä»¥çœ‹å‡ºï¼ŒMasonryä¸­å®ç°è‡ªåŠ¨å¸ƒå±€çš„å…³é”®ç±»MASConstraintMakerï¼Œä»–çš„å®ä¾‹å¹¶ä¸æ˜¯è°ƒç”¨è€…è‡ªå·±åˆ›å»ºçš„ï¼Œè€Œæ˜¯é€šè¿‡è°ƒç”¨æ–¹æ³•mas_makeConstraints:ï¼ˆè¿™é‡Œæ˜¯ç”¨äº†Categoryï¼‰ï¼Œå…¶å‚æ•°blockä¸­çš„å‚æ•°ä¼ é€’è¿‡æ¥çš„ã€‚&lt;/p&gt;

&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡mas_makeConstraints:è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“MASConstraintMakerçš„å®ä¾‹æ˜¯æ€ä¹ˆåˆ›å»ºçš„ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“å…·ä½“æ˜¯æ€ä¹ˆå®ç°äº†ç»™Viewæ·»åŠ äº†è‡ªåŠ¨å¸ƒå±€ï¼Œå”¯ä¸€éœ€è¦çš„æ˜¯å®ç°ï¼ˆä¼ é€’ï¼‰ä¸€ä¸ªblockï¼Œåœ¨blocké‡ŒæŒ‰ç…§Masonryçš„æ–¹å¼æŒ‡å®šéœ€è¦æ·»åŠ çš„çº¦æŸå°±å¯ä»¥äº†ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ç§å®ç°æ–¹å¼å°±æ˜¯æœ¬ç¯‡è¦è¯´çš„å‡½æ•°å¼ç¼–ç¨‹ã€‚&lt;/p&gt;

&lt;h4 id=&quot;section-6&quot;&gt;&lt;em&gt;å‡½æ•°å¼ç¼–ç¨‹æœ¬è´¨&lt;/em&gt;:&lt;/h4&gt;
&lt;p&gt;å°±æ˜¯å¾€æ–¹æ³•ä¸­ä¼ å…¥Block,æ–¹æ³•ä¸­åµŒå¥—Blockè°ƒç”¨ï¼ŒæŠŠä»£ç èšåˆèµ·æ¥ç®¡ç†
#### &lt;em&gt;å‡½æ•°å¼ç¼–ç¨‹ç‰¹ç‚¹&lt;/em&gt;ï¼š
æ¯ä¸ªæ–¹æ³•å¿…é¡»æœ‰è¿”å›å€¼ï¼ˆæœ¬èº«å¯¹è±¡ï¼‰,æŠŠå‡½æ•°æˆ–è€…Blockå½“åšå‚æ•°,blockå‚æ•°ï¼ˆéœ€è¦æ“ä½œçš„å€¼ï¼‰blockè¿”å›å€¼ï¼ˆæ“ä½œç»“æœï¼‰
#### &lt;em&gt;ä»£è¡¨&lt;/em&gt;ï¼š
Masonryã€ReactiveCocoa(ä¹Ÿåšå‡½æ•°å“åº”å¼ç¼–ç¨‹)ã€‚&lt;/p&gt;

&lt;h4 id=&quot;demo-2&quot;&gt;&lt;em&gt;demo&lt;/em&gt;ï¼š&lt;/h4&gt;

&lt;p&gt;ç°åœ¨æœ‰ä¸ªç±»ï¼Œå®ƒæœ‰ä¸€ä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;NSString *finalString&lt;/code&gt;å±æ€§ï¼Œæˆ‘ä¸æƒ³æš´éœ²ç»™å¤–éƒ¨ï¼Œåœ¨.hæ–‡ä»¶ä¸­æˆ‘å®šä¹‰ä¸€ä¸ªèƒ½ä¼ å…¥å¤–éƒ¨blickçš„æ–¹æ³•ï¼Œå’Œä¸€ä¸ªå¯ä»¥æ“ä½œè¿™ä¸ªå±æ€§å€¼çš„æ–¹æ³•ï¼ˆå¯èƒ½ç±»çš„å†…éƒ¨éœ€è¦è¿™ç§æ“ä½œï¼Œä½†åˆä¸æƒ³æŠŠå±æ€§æš´éœ²ï¼‰&lt;/p&gt;

&lt;p&gt;.hä»£ç ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;makeTool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TJFunctionalProgrammingClass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TJFunctionalProgrammingClass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSArray&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nonatomic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strong&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;readonly&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Function&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FunctionalAction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;.måŠ å…¥ä¸€ä¸ªç§æœ‰å±æ€§ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nonatomic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;copy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSString&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;finalString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;.mæ–¹æ³•å®ç°:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;+(NSString *)makeTool:(void (^)(TJFunctionalProgrammingClass *tool))block{
    
    if (block) {
        TJFunctionalProgrammingClass *tool = [[TJFunctionalProgrammingClass alloc]init];
        
        block(tool);
        
        return tool.finalString;
    }
    
    return nil;
}

-(Function)FunctionalAction{
    
    __weak typeof(self) weakself = self;
    return ^(NSArray&amp;lt;NSString *&amp;gt; *strings ){
        
        if (strings.count&amp;gt;0) {
            weakself.finalString = [NSString stringWithFormat:@&quot;FunctionalProgramming + %@&quot;,[strings componentsJoinedByString:@&quot;-&quot;]];
        }else{
            weakself.finalString = @&quot;FunctionalProgramming + nil&quot;;
        }
        
        return weakself;
    };
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;è°ƒç”¨ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NSString *str = [TJFunctionalProgrammingClass makeTool:^(TJFunctionalProgrammingClass *tool) {
       
        tool.FunctionalAction(@[@&quot;å¼ ä¸‰&quot;,@&quot;æå››&quot;,@&quot;ç‹äº”&quot;]);
        
    }];
    
    NSLog(@&quot;functionalProgramming----%@&quot;,str);
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

</description>
        <pubDate>Tue, 16 May 2017 16:08:13 +0800</pubDate>
        <link>/2017/05/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%E5%B0%8F%E8%A7%91/</link>
        <guid isPermaLink="true">/2017/05/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%E5%B0%8F%E8%A7%91/</guid>
        
        <category>ç¼–ç¨‹æ€æƒ³</category>
        
        <category>é“¾å¼ç¼–ç¨‹</category>
        
        <category>å“åº”å¼ç¼–ç¨‹</category>
        
        <category>å‡½æ•°å¼ç¼–ç¨‹</category>
        
        <category>ç¼–ç¨‹æ€æƒ³å°è§‘</category>
        
        
        <category>study</category>
        
      </item>
    
      <item>
        <title>iOSå¯åŠ¨é€Ÿåº¦çš„ä¼˜åŒ–</title>
        <description>&lt;p&gt;æœ€è¿‘æˆ‘ä»¬APPå®‰å“ç«¯åšäº†ä¸ªå°ä¼˜åŒ–ï¼Œå°†ç½‘ç»œæ¡†æ¶åšäº†æ›´æ¢ï¼Œå¹¶ä¸”å‡å°‘äº†å¯åŠ¨æ—¶å€™çš„ä¸€äº›åˆå§‹åŒ–ã€‚ç„¶åCTOæ‹¿ç€ä¸€ä¸ªå®‰å“æ‰‹æœºè¿‡æ¥å¯¹æˆ‘è¯´ï¼Œå®‰å“ä¼˜åŒ–åæ¯”ä½ ä»¬å¿«å¤šäº†ã€‚å•¥ï¼Ÿä¸å¯èƒ½ï¼Œè‹¹æœæ‰‹æœºå¤§å‡ åƒå‘¢ï¼ç©å„¿å‘¢ï¼Ÿï¼ä¸æœï¼Œä¸‹ç­æ‹¿äº†ä¸€ä¸ªå®‰å“2000å¤šå—çš„æ‰‹æœºè·Ÿæˆ‘çš„è‹¹æœæ‰‹æœºåšäº†ä¸€ä¸‹APPæ‰“å¼€æ¯”è¾ƒï¼Œè‹¹æœå®Œè´¥ï¼å¿…é¡»ä¸æœï¼Œå’±ä¹Ÿè¦ä¼˜åŒ–æ‰“å¼€é€Ÿåº¦ï¼&lt;/p&gt;

&lt;p&gt;å¾ˆå¤šåœ°æ–¹è¯´æµ‹ä¸€ä¸‹&lt;code class=&quot;highlighter-rouge&quot;&gt;main&lt;/code&gt;æ–¹æ³•åˆ°&lt;code class=&quot;highlighter-rouge&quot;&gt;- (BOOL)Application:(UIApplication *)Application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions&lt;/code&gt;æ–¹æ³•çš„æ—¶é—´å°±æ˜¯APPçš„æ‰“å¼€æ—¶é—´äº†ï¼Œè™½ç„¶èƒ½ä¸€å®šç¨‹åº¦ä¸Šåæ˜ è¿™ä¸ªæŒ‡æ ‡ï¼Œä½†æ˜¯ä¸ä¸¥è°¨ã€‚&lt;/p&gt;

&lt;p&gt;t(Appæ€»å¯åŠ¨æ—¶é—´) = t1(main()ä¹‹å‰çš„åŠ è½½æ—¶é—´) + t2(main()ä¹‹åçš„åŠ è½½æ—¶é—´)ã€‚ t1 = ç³»ç»Ÿdylib(åŠ¨æ€é“¾æ¥åº“)å’Œè‡ªèº«Appå¯æ‰§è¡Œæ–‡ä»¶çš„åŠ è½½ï¼› t2 = mainæ–¹æ³•æ‰§è¡Œä¹‹ååˆ°AppDelegateç±»ä¸­çš„- (BOOL)Application:(UIApplication *)Application didFinishLaunchingWithOptions:(NSDictionary *)launchOptionsæ–¹æ³•æ‰§è¡Œç»“æŸå‰è¿™æ®µæ—¶é—´ï¼Œä¸»è¦æ˜¯æ„å»ºç¬¬ä¸€ä¸ªç•Œé¢ï¼Œå¹¶å®Œæˆæ¸²æŸ“å±•ç¤ºã€‚&lt;/p&gt;

&lt;h3 id=&quot;main&quot;&gt;main()è°ƒç”¨ä¹‹å‰çš„åŠ è½½è¿‡ç¨‹&lt;/h3&gt;

&lt;p&gt;Appå¼€å§‹å¯åŠ¨åï¼Œ ç³»ç»Ÿé¦–å…ˆåŠ è½½å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆè‡ªèº«Appçš„æ‰€æœ‰.oæ–‡ä»¶çš„é›†åˆï¼‰ï¼Œç„¶ååŠ è½½åŠ¨æ€é“¾æ¥åº“dyldï¼Œdyldæ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥åŠ è½½åŠ¨æ€é“¾æ¥åº“çš„åº“ã€‚ æ‰§è¡Œä»dyldå¼€å§‹ï¼Œdyldä»å¯æ‰§è¡Œæ–‡ä»¶çš„ä¾èµ–å¼€å§‹, é€’å½’åŠ è½½æ‰€æœ‰çš„ä¾èµ–åŠ¨æ€é“¾æ¥åº“ã€‚ 
åŠ¨æ€é“¾æ¥åº“åŒ…æ‹¬ï¼šiOS ä¸­ç”¨åˆ°çš„æ‰€æœ‰ç³»ç»Ÿ frameworkï¼ŒåŠ è½½OC runtimeæ–¹æ³•çš„libobjcï¼Œç³»ç»Ÿçº§åˆ«çš„libSystemï¼Œä¾‹å¦‚libdispatch(GCD)å’Œlibsystem_blocks (Block)ã€‚&lt;/p&gt;

&lt;p&gt;å…¶å®æ— è®ºå¯¹äºç³»ç»Ÿçš„åŠ¨æ€é“¾æ¥åº“è¿˜æ˜¯å¯¹äºAppæœ¬èº«çš„å¯æ‰§è¡Œæ–‡ä»¶è€Œè¨€ï¼Œä»–ä»¬éƒ½ç®—æ˜¯imageï¼ˆé•œåƒï¼‰ï¼Œè€Œæ¯ä¸ªAppéƒ½æ˜¯ä»¥image(é•œåƒ)ä¸ºå•ä½è¿›è¡ŒåŠ è½½çš„ï¼Œé‚£ä¹ˆimageç©¶ç«ŸåŒ…æ‹¬å“ªäº›å‘¢ï¼Ÿ&lt;/p&gt;

&lt;h3 id=&quot;image&quot;&gt;ä»€ä¹ˆæ˜¯image&lt;/h3&gt;

&lt;p&gt;1.executableå¯æ‰§è¡Œæ–‡ä»¶ æ¯”å¦‚.oæ–‡ä»¶ã€‚ 
2.dylib åŠ¨æ€é“¾æ¥åº“ frameworkå°±æ˜¯åŠ¨æ€é“¾æ¥åº“å’Œç›¸åº”èµ„æºåŒ…å«åœ¨ä¸€èµ·çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ç»“æ„ã€‚ 
3.bundle èµ„æºæ–‡ä»¶ åªèƒ½ç”¨dlopenåŠ è½½ï¼Œä¸æ¨èä½¿ç”¨è¿™ç§æ–¹å¼åŠ è½½ã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº†æˆ‘ä»¬Appæœ¬èº«çš„å¯è¡Œæ€§æ–‡ä»¶ï¼Œç³»ç»Ÿä¸­æ‰€æœ‰çš„frameworkæ¯”å¦‚UIKitã€Foundationç­‰éƒ½æ˜¯ä»¥åŠ¨æ€é“¾æ¥åº“çš„æ–¹å¼é›†æˆè¿›Appä¸­çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç³»ç»Ÿä½¿ç”¨åŠ¨æ€é“¾æ¥æœ‰å‡ ç‚¹å¥½å¤„&lt;/strong&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ä»£ç å…±ç”¨&lt;/strong&gt;:å¾ˆå¤šç¨‹åºéƒ½åŠ¨æ€é“¾æ¥äº†è¿™äº› libï¼Œä½†å®ƒä»¬åœ¨å†…å­˜å’Œç£ç›˜ä¸­ä¸­åªæœ‰ä¸€ä»½ã€‚ æ˜“äºç»´æŠ¤ï¼šç”±äºè¢«ä¾èµ–çš„ lib æ˜¯ç¨‹åºæ‰§è¡Œæ—¶æ‰é“¾æ¥çš„ï¼Œæ‰€ä»¥è¿™äº› lib å¾ˆå®¹æ˜“åšæ›´æ–°ï¼Œæ¯”å¦‚libSystem.dylib æ˜¯ libSystem.B.dylib çš„æ›¿èº«ï¼Œå“ªå¤©æƒ³å‡çº§ç›´æ¥æ¢æˆlibSystem.C.dylib ç„¶åå†æ›¿æ¢æ›¿èº«å°±è¡Œäº†ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;å‡å°‘å¯æ‰§è¡Œæ–‡ä»¶ä½“ç§¯&lt;/strong&gt;:ç›¸æ¯”é™æ€é“¾æ¥ï¼ŒåŠ¨æ€é“¾æ¥åœ¨ç¼–è¯‘æ—¶ä¸éœ€è¦æ‰“è¿›å»ï¼Œæ‰€ä»¥å¯æ‰§è¡Œæ–‡ä»¶çš„ä½“ç§¯è¦å°å¾ˆå¤šã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;http://ofnft8t2g.bkt.clouddn.com/wikiimage0.png&quot; width=&quot;400&quot; height=&quot;400&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚ä¸Šæ‰€ç¤ºï¼Œä¸åŒè¿›ç¨‹ä¹‹é—´å…±ç”¨ç³»ç»Ÿdylibçš„_TEXTåŒºï¼Œä½†æ˜¯å„è‡ªç»´æŠ¤å¯¹åº”çš„_DATAåŒºã€‚&lt;/p&gt;

&lt;p&gt;æ‰€æœ‰åŠ¨æ€é“¾æ¥åº“å’Œæˆ‘ä»¬Appä¸­çš„é™æ€åº“.aå’Œæ‰€æœ‰ç±»æ–‡ä»¶ç¼–è¯‘åçš„.oæ–‡ä»¶æœ€ç»ˆéƒ½æ˜¯ç”±dyld(the dynamic link editor)å³Appleçš„åŠ¨æ€é“¾æ¥å™¨æ¥åŠ è½½åˆ°å†…å­˜ä¸­ã€‚æ¯ä¸ªimageéƒ½æ˜¯ç”±ä¸€ä¸ªå«åšImageLoaderçš„ç±»æ¥è´Ÿè´£åŠ è½½ï¼ˆä¸€ä¸€å¯¹åº”ï¼‰ï¼Œé‚£ä¹ˆImageLoaderåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;

&lt;h3 id=&quot;imageloader&quot;&gt;ä»€ä¹ˆæ˜¯ImageLoader&lt;/h3&gt;

&lt;p&gt;image è¡¨ç¤ºä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶(å¯æ‰§è¡Œæ–‡ä»¶æˆ– so æ–‡ä»¶)ï¼Œé‡Œé¢æ˜¯è¢«ç¼–è¯‘è¿‡çš„ç¬¦å·ã€ä»£ç ç­‰ï¼Œæ‰€ä»¥ ImageLoader ä½œç”¨æ˜¯å°†è¿™äº›æ–‡ä»¶åŠ è½½è¿›å†…å­˜ï¼Œä¸”æ¯ä¸€ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ªImageLoaderå®ä¾‹æ¥è´Ÿè´£åŠ è½½ã€‚ 
ä¸¤æ­¥èµ°ï¼š åœ¨ç¨‹åºè¿è¡Œæ—¶å®ƒå…ˆå°†åŠ¨æ€é“¾æ¥çš„ image é€’å½’åŠ è½½ (ä¹Ÿå°±æ˜¯ä¸Šé¢æµ‹è¯•æ ˆä¸­ä¸€ä¸²çš„é€’å½’è°ƒç”¨çš„æ—¶åˆ»)ã€‚ å†ä»å¯æ‰§è¡Œæ–‡ä»¶ image é€’å½’åŠ è½½æ‰€æœ‰ç¬¦å·ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€æœ‰è¿™äº›éƒ½å‘ç”Ÿåœ¨æˆ‘ä»¬çœŸæ­£çš„mainå‡½æ•°æ‰§è¡Œå‰ã€‚&lt;/p&gt;

&lt;h3 id=&quot;section&quot;&gt;åŠ¨æ€é“¾æ¥åº“åŠ è½½çš„å…·ä½“æµç¨‹&lt;/h3&gt;

&lt;p&gt;åŠ¨æ€é“¾æ¥åº“çš„åŠ è½½æ­¥éª¤å…·ä½“åˆ†ä¸º5æ­¥ï¼š&lt;/p&gt;

&lt;h4 id=&quot;load-dylibs-image-&quot;&gt;&lt;strong&gt;ä¸€.load dylibs image&lt;/strong&gt; è¯»å–åº“é•œåƒæ–‡ä»¶&lt;/h4&gt;

&lt;blockquote&gt;
  &lt;p&gt;åœ¨æ¯ä¸ªåŠ¨æ€åº“çš„åŠ è½½è¿‡ç¨‹ä¸­ï¼Œdyldéœ€è¦ï¼š&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;1.åˆ†ææ‰€ä¾èµ–çš„åŠ¨æ€åº“
2.æ‰¾åˆ°åŠ¨æ€åº“çš„mach-oæ–‡ä»¶
3.æ‰“å¼€æ–‡ä»¶
4.éªŒè¯æ–‡ä»¶
5.åœ¨ç³»ç»Ÿæ ¸å¿ƒæ³¨å†Œæ–‡ä»¶ç­¾å
6.å¯¹åŠ¨æ€åº“çš„æ¯ä¸€ä¸ªsegmentè°ƒç”¨mmap()&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;é€šå¸¸çš„ï¼Œä¸€ä¸ªAppéœ€è¦åŠ è½½100åˆ°400ä¸ªdylibsï¼Œ ä½†æ˜¯å…¶ä¸­çš„ç³»ç»Ÿåº“è¢«ä¼˜åŒ–ï¼Œå¯ä»¥å¾ˆå¿«çš„åŠ è½½ã€‚ é’ˆå¯¹è¿™ä¸€æ­¥éª¤çš„ä¼˜åŒ–æœ‰ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;1.å‡å°‘éç³»ç»Ÿåº“çš„ä¾èµ–
2.åˆå¹¶éç³»ç»Ÿåº“
3.ä½¿ç”¨é™æ€èµ„æºï¼Œæ¯”å¦‚æŠŠä»£ç åŠ å…¥ä¸»ç¨‹&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;rebase-image&quot;&gt;&lt;strong&gt;Rebase image&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;ç”±äºASLR(address space layout randomization)çš„å­˜åœ¨ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å’ŒåŠ¨æ€é“¾æ¥åº“åœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„åŠ è½½åœ°å€æ¯æ¬¡å¯åŠ¨éƒ½ä¸å›ºå®šï¼Œæ‰€ä»¥éœ€è¦è¿™2æ­¥æ¥ä¿®å¤é•œåƒä¸­çš„èµ„æºæŒ‡é’ˆï¼Œæ¥æŒ‡å‘æ­£ç¡®çš„åœ°å€ã€‚ rebaseä¿®å¤çš„æ˜¯æŒ‡å‘å½“å‰é•œåƒå†…éƒ¨çš„èµ„æºæŒ‡é’ˆï¼› è€ŒbindæŒ‡å‘çš„æ˜¯é•œåƒå¤–éƒ¨çš„èµ„æºæŒ‡é’ˆã€‚ 
rebaseæ­¥éª¤å…ˆè¿›è¡Œï¼Œéœ€è¦æŠŠé•œåƒè¯»å…¥å†…å­˜ï¼Œå¹¶ä»¥pageä¸ºå•ä½è¿›è¡ŒåŠ å¯†éªŒè¯ï¼Œä¿è¯ä¸ä¼šè¢«ç¯¡æ”¹ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥çš„ç“¶é¢ˆåœ¨IOã€‚bindåœ¨å…¶åè¿›è¡Œï¼Œç”±äºè¦æŸ¥è¯¢ç¬¦å·è¡¨ï¼Œæ¥æŒ‡å‘è·¨é•œåƒçš„èµ„æºï¼ŒåŠ ä¸Šåœ¨rebaseé˜¶æ®µï¼Œé•œåƒå·²è¢«è¯»å…¥å’ŒåŠ å¯†éªŒè¯ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥çš„ç“¶é¢ˆåœ¨äºCPUè®¡ç®—ã€‚ 
é€šè¿‡å‘½ä»¤è¡Œå¯ä»¥æŸ¥çœ‹ç›¸å…³çš„èµ„æºæŒ‡é’ˆ:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;xcrun dyldinfo -rebase -bind -lazy_bind myApp.App/myApp
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;ä¼˜åŒ–è¯¥é˜¶æ®µçš„å…³é”®åœ¨äºå‡å°‘__DATA segmentä¸­çš„æŒ‡é’ˆæ•°é‡ã€‚æˆ‘ä»¬å¯ä»¥ä¼˜åŒ–çš„ç‚¹æœ‰ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;1.å‡å°‘Objcç±»æ•°é‡ï¼Œ å‡å°‘selectoræ•°é‡
2.å‡å°‘C++è™šå‡½æ•°æ•°é‡
3.è½¬è€Œä½¿ç”¨swift stuctï¼ˆå…¶å®æœ¬è´¨ä¸Šå°±æ˜¯ä¸ºäº†å‡å°‘ç¬¦å·çš„æ•°é‡ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;bind-image&quot;&gt;&lt;strong&gt;Bind image&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;ä¸Šéƒ¨å·²è¿å¸¦è®²è§£&lt;/p&gt;

&lt;h4 id=&quot;objc-setup&quot;&gt;&lt;strong&gt;Objc setup&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;è¿™ä¸€æ­¥ä¸»è¦å·¥ä½œæ˜¯:
&amp;gt;1.æ³¨å†ŒObjcç±» (class registration)
&amp;gt;2.æŠŠcategoryçš„å®šä¹‰æ’å…¥æ–¹æ³•åˆ—è¡¨ (category registration)
&amp;gt;3.ä¿è¯æ¯ä¸€ä¸ªselectorå”¯ä¸€ (selctor uniquing)
ç”±äºä¹‹å‰2æ­¥éª¤çš„ä¼˜åŒ–ï¼Œè¿™ä¸€æ­¥å®é™…ä¸Šæ²¡æœ‰ä»€ä¹ˆå¯åšçš„ã€‚&lt;/p&gt;

&lt;h4 id=&quot;initializers&quot;&gt;&lt;strong&gt;initializers&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;ä»¥ä¸Šä¸‰æ­¥å±äºé™æ€è°ƒæ•´(fix-up)ï¼Œéƒ½æ˜¯åœ¨ä¿®æ”¹__DATA segmentä¸­çš„å†…å®¹ï¼Œè€Œè¿™é‡Œåˆ™å¼€å§‹åŠ¨æ€è°ƒæ•´ï¼Œå¼€å§‹åœ¨å †å’Œå †æ ˆä¸­å†™å…¥å†…å®¹ã€‚ åœ¨è¿™é‡Œçš„å·¥ä½œæœ‰ï¼š
&amp;gt;1.Objcçš„+load()å‡½æ•°
&amp;gt;2.C++çš„æ„é€ å‡½æ•°å±æ€§å‡½æ•° å½¢å¦‚attribute((constructor)) void DoSomeInitializationWork()
&amp;gt;3.éåŸºæœ¬ç±»å‹çš„C++é™æ€å…¨å±€å˜é‡çš„åˆ›å»º(é€šå¸¸æ˜¯ç±»æˆ–ç»“æ„ä½“)(non-trivial initializer) æ¯”å¦‚ä¸€ä¸ªå…¨å±€é™æ€ç»“æ„ä½“çš„æ„å»ºï¼Œå¦‚æœåœ¨æ„é€ å‡½æ•°ä¸­æœ‰ç¹é‡çš„å·¥ä½œï¼Œé‚£ä¹ˆä¼šæ‹–æ…¢å¯åŠ¨é€Ÿåº¦
Objcçš„loadå‡½æ•°å’ŒC++çš„é™æ€æ„é€ å‡½æ•°é‡‡ç”¨ç”±åº•å‘ä¸Šçš„æ–¹å¼æ‰§è¡Œï¼Œæ¥ä¿è¯æ¯ä¸ªæ‰§è¡Œçš„æ–¹æ³•ï¼Œéƒ½å¯ä»¥æ‰¾åˆ°æ‰€ä¾èµ–çš„åŠ¨æ€åº“ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://ofnft8t2g.bkt.clouddn.com/wikiimage1.png&quot; width=&quot;300&quot; height=&quot;200&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šå›¾æ˜¯åœ¨è‡ªå®šä¹‰çš„ç±»XXViewControllerçš„+loadæ–¹æ³•æ–­ç‚¹çš„è°ƒç”¨å †æ ˆï¼Œæ¸…æ¥šçš„çœ‹åˆ°æ•´ä¸ªè°ƒç”¨æ ˆå’Œé¡ºåºï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;1.dyld å¼€å§‹å°†ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶åˆå§‹åŒ–
2.äº¤ç”± ImageLoader è¯»å– imageï¼Œå…¶ä¸­åŒ…å«äº†æˆ‘ä»¬çš„ç±»ã€æ–¹æ³•ç­‰å„ç§ç¬¦å·
3.ç”±äº runtime å‘ dyld ç»‘å®šäº†å›è°ƒï¼Œå½“ image åŠ è½½åˆ°å†…å­˜åï¼Œdyld ä¼šé€šçŸ¥ runtime è¿›è¡Œå¤„ç†
4.runtime æ¥æ‰‹åè°ƒç”¨ mapimages åšè§£æå’Œå¤„ç†ï¼Œæ¥ä¸‹æ¥ loadimages ä¸­è°ƒç”¨ callloadmethods æ–¹æ³•ï¼Œéå†æ‰€æœ‰åŠ è½½è¿›æ¥çš„ Classï¼ŒæŒ‰ç»§æ‰¿å±‚çº§ä¾æ¬¡è°ƒç”¨ Class çš„ +load æ–¹æ³•å’Œå…¶ Category çš„ +load æ–¹æ³•&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;è‡³æ­¤ï¼Œå¯æ‰§è¡Œæ–‡ä»¶ä¸­å’ŒåŠ¨æ€åº“æ‰€æœ‰çš„ç¬¦å·(Classï¼ŒProtocolï¼ŒSelectorï¼ŒIMPï¼Œâ€¦)éƒ½å·²ç»æŒ‰æ ¼å¼æˆåŠŸåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¢« runtime æ‰€ç®¡ç†ï¼Œå†è¿™ä¹‹åï¼Œruntime çš„é‚£äº›æ–¹æ³•(åŠ¨æ€æ·»åŠ  Classã€swizzle ç­‰ç­‰æ‰èƒ½ç”Ÿæ•ˆ)ã€‚&lt;/p&gt;

&lt;p&gt;æ•´ä¸ªäº‹ä»¶ç”± dyld ä¸»å¯¼ï¼Œå®Œæˆè¿è¡Œç¯å¢ƒçš„åˆå§‹åŒ–åï¼Œé…åˆ ImageLoader å°†äºŒè¿›åˆ¶æ–‡ä»¶æŒ‰æ ¼å¼åŠ è½½åˆ°å†…å­˜ï¼Œ åŠ¨æ€é“¾æ¥ä¾èµ–åº“ï¼Œå¹¶ç”± runtime è´Ÿè´£åŠ è½½æˆ objc å®šä¹‰çš„ç»“æ„ï¼Œæ‰€æœ‰åˆå§‹åŒ–å·¥ä½œç»“æŸåï¼Œdyld è°ƒç”¨çœŸæ­£çš„ main å‡½æ•°ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœç¨‹åºåˆšåˆšè¢«è¿è¡Œè¿‡ï¼Œé‚£ä¹ˆç¨‹åºçš„ä»£ç ä¼šè¢«dyldç¼“å­˜ï¼Œå› æ­¤å³ä½¿æ€æ‰è¿›ç¨‹å†æ¬¡é‡å¯åŠ è½½æ—¶é—´ä¹Ÿä¼šç›¸å¯¹å¿«ä¸€ç‚¹ï¼Œå¦‚æœé•¿æ—¶é—´æ²¡æœ‰å¯åŠ¨æˆ–è€…å½“å‰dyldçš„ç¼“å­˜å·²ç»è¢«å…¶ä»–åº”ç”¨å æ®ï¼Œé‚£ä¹ˆè¿™æ¬¡å¯åŠ¨æ‰€èŠ±è´¹çš„æ—¶é—´å°±è¦é•¿ä¸€ç‚¹ï¼Œè¿™å°±åˆ†åˆ«æ˜¯çƒ­å¯åŠ¨å’Œå†·å¯åŠ¨çš„æ¦‚å¿µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://ofnft8t2g.bkt.clouddn.com/wikiimage2.png&quot; width=&quot;300&quot; height=&quot;200&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;main-1&quot;&gt;main()å‡½æ•°ä¹‹å‰çš„åŠ è½½æ—¶é—´è¡¡é‡&lt;/h3&gt;

&lt;p&gt;è‹¹æœå®˜æ–¹æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œé‚£å°±æ˜¯åœ¨çœŸæœºè°ƒè¯•çš„æ—¶å€™å‹¾é€‰dyldPRINTSTATISTICSé€‰é¡¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://ofnft8t2g.bkt.clouddn.com/wikiimage3.png&quot; width=&quot;500&quot; height=&quot;300&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¼šå¾—åˆ°å¦‚ä¸‹å½¢å¼çš„è¾“å‡º:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://ofnft8t2g.bkt.clouddn.com/wikiimage4.png&quot; width=&quot;400&quot; height=&quot;300&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¯¹äºç³»ç»Ÿçº§åˆ«çš„åŠ¨æ€é“¾æ¥åº“ï¼Œå› ä¸ºè‹¹æœåšäº†ä¼˜åŒ–ï¼Œæ‰€ä»¥è€—æ—¶å¹¶ä¸å¤šï¼Œåœ¨è¿™ä¸ªawesomeçš„ä¾‹å­ä¸­ï¼Œè‡ªèº«Appä¸­çš„ä»£ç å ç”¨äº†æ•´ä½“æ—¶é—´çš„94.2% æˆ‘ä»¬åº”ç”¨ä¸­ä¸€æ¬¡å…¸å‹çš„Logå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://ofnft8t2g.bkt.clouddn.com/wikiimage5.png&quot; width=&quot;500&quot; height=&quot;300&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç”±æ­¤å¯è§ï¼Œæœ€å¤šçš„ç”¨æ—¶è¿˜æ˜¯åœ¨imageåŠ è½½å’ŒOCç±»çš„åˆå§‹åŒ–ï¼Œå…±å ç”¨æ€»æ—¶é•¿çš„79.3%ï¼Œç²¾ç®€frameworkçš„å¼•å…¥å’ŒOCç±»æœ‰ä¼˜åŒ–çš„ç©ºé—´ã€‚&lt;/p&gt;

&lt;p&gt;æ€»ç»“ä¸€ä¸‹ï¼šå¯¹äºmain()è°ƒç”¨ä¹‹å‰çš„è€—æ—¶æˆ‘ä»¬å¯ä»¥ä¼˜åŒ–çš„ç‚¹æœ‰ï¼š&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;1.å‡å°‘ä¸å¿…è¦çš„frameworkï¼Œå› ä¸ºåŠ¨æ€é“¾æ¥æ¯”è¾ƒè€—æ—¶
2.check frameworkåº”å½“è®¾ä¸ºoptionalå’Œrequiredï¼Œå¦‚æœè¯¥frameworkåœ¨å½“å‰Appæ”¯æŒçš„æ‰€æœ‰iOSç³»ç»Ÿç‰ˆæœ¬éƒ½å­˜åœ¨ï¼Œé‚£ä¹ˆå°±è®¾ä¸ºrequiredï¼Œå¦åˆ™å°±è®¾ä¸ºoptionalï¼Œå› ä¸ºoptionalä¼šæœ‰äº›é¢å¤–çš„æ£€æŸ¥
3.åˆå¹¶æˆ–è€…åˆ å‡ä¸€äº›OCç±»ï¼Œå…³äºæ¸…ç†é¡¹ç›®ä¸­æ²¡ç”¨åˆ°çš„ç±»ï¼Œä½¿ç”¨å·¥å…·AppCodeä»£ç æ£€æŸ¥åŠŸèƒ½ï¼ŒæŸ¥åˆ°å½“å‰é¡¹ç›®ä¸­æ²¡æœ‰ç”¨åˆ°çš„ç±»å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;http://ofnft8t2g.bkt.clouddn.com/wikiimage6_new.png&quot; width=&quot;500&quot; height=&quot;350&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç„¶åå¤„ç†æ­¥éª¤å¤§æ¦‚å¦‚ä¸‹ï¼š
a.åˆ å‡ä¸€äº›æ— ç”¨çš„é™æ€å˜é‡
b.åˆ å‡æ²¡æœ‰è¢«è°ƒç”¨åˆ°æˆ–è€…å·²ç»åºŸå¼ƒçš„æ–¹æ³•
æ–¹æ³•è§ï¼š
&amp;gt;http://stackoverflow.com/questions/35233564/how-to-find-unused-code-in-xcode-7
&amp;gt;https://developer.Apple.com/library/ios/documentation/ToolsLanguages/Conceptual/Xcode_Overview/CheckingCodeCoverage.html
c.å°†ä¸å¿…é¡»åœ¨+loadæ–¹æ³•ä¸­åšçš„äº‹æƒ…å»¶è¿Ÿåˆ°+initializeä¸­
d.å°½é‡ä¸è¦ç”¨C++è™šå‡½æ•°(åˆ›å»ºè™šå‡½æ•°è¡¨æœ‰å¼€é”€)&lt;/p&gt;

&lt;h3 id=&quot;main-2&quot;&gt;mainå‡½æ•°ä¹‹ååŠ è½½æ—¶é—´ä¼˜åŒ–è®°å½•&lt;/h3&gt;

&lt;p&gt;NSUserDefaultsæ˜¯å¦æ˜¯ç“¶é¢ˆ?
è‹¹æœå®˜æ–¹æ–‡æ¡£æåˆ°NSUserDefaultsåŠ è½½çš„æ—¶å€™æ˜¯æ•´ä¸ªplisté…ç½®æ–‡ä»¶å…¨éƒ¨loadåˆ°å†…å­˜ä¸­ï¼Œä½†æ˜¯æµ‹è¯•ç»“æœæ˜¾ç¤ºå¹¶ä¸ä¼šã€‚ é€šè¿‡ç¬¦å·æ–­ç‚¹+[NSUserDefaults standardUserDefaults]ç¡®å®šæœ€æ—©ä¸€æ¬¡çš„+load()ä»æ‰§è¡Œåˆ°ç»“æŸè€—æ—¶1.8msï¼Œå¯è§NSUserDefaultsçš„åˆå§‹åŒ–ä»…è€—æ—¶1.8msï¼Œå¹¶ä¸æ˜¯å¯åŠ¨è€—æ—¶çš„ç“¶é¢ˆã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†æ‰¾åˆ°ç“¶é¢ˆï¼Œåœ¨å¯åŠ¨ä¹‹åçš„didFinishLauhcningæ–¹æ³•å¼€å§‹æ‰§è¡Œåˆ°é¦–é¡µåˆ—è¡¨é¡µçš„WZMainViewControllerçš„viewDidAppearæ–¹æ³•ï¼Œå‡ ä¹æ¯ä¸ªå¯èƒ½æ¯”è¾ƒè€—æ—¶çš„æµç¨‹è¿›è¡Œæ‹†åˆ†å’Œç»Ÿè®¡ï¼Œå¾—åˆ°ç»Ÿè®¡æ•°æ®ä¹‹åå‘ç°ï¼š ä¸»è¦è€—æ—¶åœ¨é¦–é¡µUIæ„é€ å’Œæ¸²æŸ“(storyboardåŠ è½½ï¼ŒtabBar/topBaræ¸²æŸ“ï¼Œå¼€å±å¹¿å‘ŠåŠ è½½/cellæ³¨å†Œ/æ—¥å¿—æ¨¡å—åˆå§‹åŒ–è¿™å‡ ä¸ªæ­¥éª¤)ã€‚&lt;/p&gt;

&lt;h4 id=&quot;section-1&quot;&gt;&lt;strong&gt;å…·ä½“ä¼˜åŒ–ç‚¹&lt;/strong&gt;&lt;/h4&gt;

&lt;p&gt;1.çº¯ä»£ç æ–¹å¼è€Œä¸æ˜¯storyboardåŠ è½½é¦–é¡µUIã€‚
2.å¯¹didFinishLaunchingé‡Œçš„å‡½æ•°è€ƒè™‘èƒ½å¦æŒ–æ˜å¯ä»¥å»¶è¿ŸåŠ è½½æˆ–è€…æ‡’åŠ è½½ï¼Œéœ€è¦ä¸å„ä¸ªä¸šåŠ¡æ–¹pmå’Œrdå…±åŒcheck å¯¹äºä¸€äº›å·²ç»ä¸‹çº¿çš„ä¸šåŠ¡ï¼Œåˆ å‡å†—ä½™ä»£ç ã€‚å¯¹äºä¸€äº›ä¸UIå±•ç¤ºæ— å…³çš„ä¸šåŠ¡ï¼Œå¦‚å¾®åšè®¤è¯è¿‡æœŸæ£€æŸ¥ã€å›¾ç‰‡æœ€å¤§ç¼“å­˜ç©ºé—´è®¾ç½®ç­‰åšå»¶è¿ŸåŠ è½½
3.å¯¹å®ç°äº†+load()æ–¹æ³•çš„ç±»è¿›è¡Œåˆ†æï¼Œå°½é‡å°†loadé‡Œçš„ä»£ç å»¶åè°ƒç”¨ã€‚
4.ä¸Šé¢ç»Ÿè®¡æ•°æ®æ˜¾ç¤ºå±•ç¤ºfeedçš„å¯¼èˆªæ§åˆ¶å™¨é¡µé¢(WZMainViewController)æ¯”è¾ƒè€—æ—¶ï¼Œå¯¹äºviewDidLoadä»¥åŠviewWillAppearæ–¹æ³•ä¸­å°½é‡å»å°è¯•å°‘åšï¼Œæ™šåšï¼Œä¸åšã€‚&lt;/p&gt;

</description>
        <pubDate>Mon, 15 May 2017 16:08:13 +0800</pubDate>
        <link>/2017/05/iOS%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6%E7%9A%84%E4%BC%98%E5%8C%96/</link>
        <guid isPermaLink="true">/2017/05/iOS%E5%90%AF%E5%8A%A8%E9%80%9F%E5%BA%A6%E7%9A%84%E4%BC%98%E5%8C%96/</guid>
        
        <category>ä¼˜åŒ–</category>
        
        <category>å¯åŠ¨é€Ÿåº¦</category>
        
        <category>iOSå¯åŠ¨é€Ÿåº¦çš„ä¼˜åŒ–</category>
        
        
        <category>study</category>
        
      </item>
    
      <item>
        <title>iOSçš„httpsè®¤è¯(äºŒ)</title>
        <description>&lt;p&gt;ä¸Šç¯‡æ–‡ç« è®²äº†iOSå’ŒæœåŠ¡å™¨å¦‚ä½•ä»å®˜æ–¹æœºæ„è¯·æ±‚CAè¯ä¹¦è¿›è¡Œhttpsé…ç½®ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥è®²è®²å¦‚ä½•è‡ªå»ºè¯ä¹¦æ¥é…ç½®httpsï¼Œé’ˆå¯¹AFNetworkingç½‘ç»œæ¡†æ¶å’Œè‹¹æœè‡ªå¸¦æ¡†æ¶NSURLConnectionã€‚&lt;/p&gt;

&lt;h3 id=&quot;afnetworking&quot;&gt;AFNetworking&lt;/h3&gt;

&lt;p&gt;1.æŠŠæœåŠ¡å™¨ç»™ä½ çš„è‡ªç­¾è¯çš„è¯ä¹¦æ”¾å…¥bundleä¸€èˆ¬æ˜¯.ceræ–‡ä»¶&lt;/p&gt;

&lt;p&gt;2.åˆ›å»ºafnnetworking å®‰å…¨ç­–ç•¥å¯¹è±¡,å¹¶è®¾ç½®å‘èµ·è¯·æ±‚managerçš„å®‰å…¨ç­–ç•¥å±æ€§.è®¾ç½®äº†å®‰å…¨ç­–ç•¥å±æ€§,afnnetworkingä¼šè‡ªåŠ¨æ‰«æbundlé‡Œçš„è¯ä¹¦.&lt;/p&gt;

&lt;p&gt;3.æœ€å‘çš„æ˜¯ iOS9æ–°å‡ºçš„App Transport Security ä¹Ÿå°±æ˜¯è¦æˆ‘ä»¬æŠŠæ‰€æœ‰è¯·æ±‚ä» HTTPæ”¹æˆHTTPSçš„å®¶ä¼™, å®ƒç«Ÿç„¶ä¸è®¤è‡ªç­¾è¯çš„è¯ä¹¦. è‹¹æœå¤§çˆ·éš¾é“çœŸæ˜¯åœŸè±ªæƒ¯äº†,ä»¥ä¸ºæˆ‘ä»¬å¼€å‘è€…éƒ½ä¼šä¹°caçš„è¯ä¹¦å—. è§£å†³åŠæ³•å°±æ˜¯é‚£é‡Œè¿˜æ˜¯è¦è®¾ç½®åœ¨Info.plistä¸­æ·»åŠ NSAppTransportSecurityç±»å‹Dictionaryåœ¨NSAppTransportSecurityä¸‹æ·»åŠ NSAllowsArbitraryLoadsç±»å‹ Boolean,å€¼è®¾ä¸ºYES&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;NSString *cerPath = [[NSBundle mainBundle] pathForResource:@&quot;https&quot; ofType:@&quot;cer&quot;];

NSData *certData = [NSData dataWithContentsOfFile:cerPath];

//AFSSLPinningModeCertificate ä½¿ç”¨è¯ä¹¦éªŒè¯æ¨¡å¼

AFSecurityPolicy *securityPolicy = [AFSecurityPolicy policyWithPinningMode:AFSSLPinningModeCertificate];

//allowInvalidCertificates æ˜¯å¦å…è®¸æ— æ•ˆè¯ä¹¦ï¼ˆä¹Ÿå°±æ˜¯è‡ªå»ºçš„è¯ä¹¦ï¼‰ï¼Œé»˜è®¤ä¸ºNO

//å¦‚æœæ˜¯éœ€è¦éªŒè¯è‡ªå»ºè¯ä¹¦ï¼Œéœ€è¦è®¾ç½®ä¸ºYES

securityPolicy.allowInvalidCertificates = YES;

securityPolicy.validatesDomainName = NO;

NSSet *set = [[NSSet alloc] initWithObjects:certData, nil];

securityPolicy.pinnedCertificates = set;

AFHTTPSessionManager *manager = [AFHTTPSessionManager manager];

manager.requestSerializer = [AFJSONRequestSerializer serializer];

manager.responseSerializer=[AFJSONResponseSerializer serializer];

manager.responseSerializer.acceptableContentTypes = [manager.responseSerializer.acceptableContentTypes setByAddingObject:@&quot;text/html&quot;];

[manager setSecurityPolicy:securityPolicy];
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;nsurlconnection&quot;&gt;NSURLConnection&lt;/h3&gt;

&lt;p&gt;NSURLConnection ä½¿ç”¨è‡ªç­¾è¯è¯ä¹¦æ”¯æŒHTTPS,åªéœ€è¦åœ¨å®ç°NSURLConnectionçš„ä»£ç†æ–¹æ³•å³å¯. å‚è€ƒ&lt;a href=&quot;https://gist.github.com/JacksonTian/5855751&quot;&gt;GitHub JacksonTian&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;- (BOOL)connection:(NSURLConnection *)connection canAuthenticateAgainstProtectionSpace:(NSURLProtectionSpace *)protectionSpace{

    return [protectionSpace.authenticationMethod isEqualToString:NSURLAuthenticationMethodServerTrust];
}

- (void)connection:(NSURLConnection *)connection didReceiveAuthenticationChallenge:(NSURLAuthenticationChallenge *)challenge
{
    static CFArrayRef certs;
    if (!certs) {
        //åˆ›å»ºè¯ä¹¦data
        NSData*certData =[NSData dataWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@&quot;HTTPS&quot; ofType:@&quot;cer&quot;]];

        SecCertificateRef rootcert = SecCertificateCreateWithData(kCFAllocatorDefault,CFBridgingRetain(certData));
        const void *array[1] = { rootcert };
        certs = CFArrayCreate(NULL, array, 1, &amp;amp;kCFTypeArrayCallBacks);
//        CFRelease(rootcert);    // for completeness, really does not matter
    }

    SecTrustRef trust = [[challenge protectionSpace] serverTrust];
    int err;
    SecTrustResultType trustResult = 0;
    err = SecTrustSetAnchorCertificates(trust, certs);
    if (err == noErr) {
        err = SecTrustEvaluate(trust,&amp;amp;trustResult);
    }
//    BOOL trusted = (err == noErr) &amp;amp;&amp;amp; ((trustResult == kSecTrustResultProceed)||(trustResult == kSecTrustResultConfirm) || (trustResult == kSecTrustResultUnspecified));
    BOOL trusted = (err == noErr) &amp;amp;&amp;amp; ((trustResult == kSecTrustResultProceed) || (trustResult == kSecTrustResultUnspecified));

    if (trusted) {

        [challenge.sender useCredential:[NSURLCredential credentialForTrust:challenge.protectionSpace.serverTrust] forAuthenticationChallenge:challenge];
    }
    else{

        [challenge.sender cancelAuthenticationChallenge:challenge];
    }

//CFRelease(trust);

}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

</description>
        <pubDate>Thu, 11 May 2017 22:08:13 +0800</pubDate>
        <link>/2017/05/iOS%E7%9A%84https%E8%AE%A4%E8%AF%81-%E4%BA%8C/</link>
        <guid isPermaLink="true">/2017/05/iOS%E7%9A%84https%E8%AE%A4%E8%AF%81-%E4%BA%8C/</guid>
        
        <category>ç½‘ç»œ</category>
        
        <category>https</category>
        
        <category>iOSçš„httpsè®¤è¯(äºŒ)</category>
        
        
        <category>study</category>
        
      </item>
    
      <item>
        <title>iOSçš„httpsè®¤è¯(ä¸€)</title>
        <description>&lt;p&gt;è‹¹æœå®˜æ–¹åœ¨2017å¹´å¹´åˆè¦æ±‚APPå¿…é¡»é…ç½®httpsï¼ˆè¿™é‡Œå¯ä»¥ä»&lt;a href=&quot;https://onevcat.com/2016/06/ios-10-ats/&quot;&gt;å–µç¥çš„åšå®¢&lt;/a&gt;äº†è§£ï¼‰ï¼Œå¯æ˜¯åæ¥ä¸çŸ¥å•¥åŸå› ææµ…äº†ï¼Œä½†è¿™ä¸ªä¸œè¥¿ç»ˆç©¶è¿˜æ˜¯è¦åšçš„ã€‚ä¸ç„¶éšä¾¿ä¸€ä¸ªæŠ“åŒ…å·¥å…·ï¼ˆcharlesç­‰ï¼‰éšéšä¾¿ä¾¿å°±èƒ½æŠ“åˆ°ä½ æ‰€è¯·æ±‚çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®å¦‚æœæ˜¯æ˜ç çš„åæœå¾ˆä¸¥é‡ï¼ˆä¸æ˜¯æŒ‡æ˜æ–‡ï¼‰ï¼Œå¯ä»¥é€šè¿‡è¿™äº›æ•°æ®æ¥åˆ¤å®šæœåŠ¡ç«¯éƒ¨ç½²çš„æ•°æ®æ¥å£ï¼Œæ›´èƒ½å¤Ÿå—…æ¢åˆ°æœåŠ¡ç«¯çš„æ¼æ´ã€‚è€Œç°åœ¨ç»å¤§éƒ¨åˆ†APPä½¿ç”¨çš„éƒ½æ˜¯AFNetworkingè¿™ä¸ªç½‘ç»œæ¡†æ¶ï¼Œæˆ‘ä»¬å°±å¯¹AFNetworkingå¦‚ä½•é…ç½®httpsæ¥åšæ¢è®¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æœåŠ¡å™¨ç«¯å¦‚ä½•å®ç°https&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¿™é‡Œå°±ä¸åœ¨èµ˜è¿°httpsçš„åŸç†äº†ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šä»‹ç»çš„æ–‡ç« ã€‚httpsä¹‹æ‰€ä»¥å®‰å…¨æ˜¯å› ä¸ºå®ƒé‡‡ç”¨äº†SSL/TLSåè®®çš„å…¬é’¥åŠ å¯†æ³•ï¼Œå…¶è¿è¡Œçš„åŸºæœ¬æµç¨‹æ˜¯ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯ç´¢è¦å¹¶éªŒè¯å…¬é’¥ï¼›&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;åŒæ–¹åå•†ç”Ÿæˆâ€å¯¹è¯å¯†é’¥â€ï¼›&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;åŒæ–¹é‡‡ç”¨â€å¯¹è¯å¯†é’¥â€è¿›è¡ŒåŠ å¯†é€šä¿¡ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å…¶ä¸­ï¼Œç¬¬1å’Œ2æ­¥è¢«ç§°ä¸ºæ¡æ‰‹é˜¶æ®µã€‚æ¡æ‰‹é˜¶æ®µçš„ç»†èŠ‚è¿™é‡Œå°±ä¸èµ˜è¿°ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ï¼Œé€šè¿‡æ¡æ‰‹é˜¶æ®µï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¸»è¦äº¤æ¢äº†3ä¸ªä¿¡æ¯ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;1ï¼Œæ•°å­—è¯ä¹¦ã€‚è¯¥ä¿¡æ¯æ˜¯æˆ‘ä»¬è¿›è¡Œå¼€å‘éœ€è¦å…³æ³¨çš„ï¼æ•°å­—è¯ä¹¦åŒ…å«äº†å…¬é’¥ç­‰ä¿¡æ¯ï¼Œä¸€èˆ¬ç”±æœåŠ¡å™¨å‘ç»™å®¢æˆ·ç«¯ï¼Œæ¥æ”¶æ–¹é€šè¿‡éªŒè¯è¿™ä¸ªè¯ä¹¦æ˜¯ä¸æ˜¯ç”±ä¿¡èµ–çš„CAç­¾å‘ï¼Œæˆ–è€…ä¸æœ¬åœ°çš„è¯ä¹¦ç›¸å¯¹æ¯”ï¼Œæ¥åˆ¤æ–­è¯ä¹¦æ˜¯å¦å¯ä¿¡ï¼›å‡å¦‚éœ€è¦åŒå‘éªŒè¯ï¼Œåˆ™æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½éœ€è¦å‘é€æ•°å­—è¯ä¹¦ç»™å¯¹æ–¹éªŒè¯ï¼›&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;2ï¼Œ3ä¸ªéšæœºæ•°ã€‚3ä¸ªéšæœºæ•°æ˜¯ç”¨äºç”Ÿæˆå¯¹è¯å¯†é’¥çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒè¿™ç»†èŠ‚ï¼›&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;3ï¼ŒåŠ å¯†é€šä¿¡åè®®ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯é€šä¿¡éœ€è¦é‡‡å–åŒæ ·çš„åŠ å¯†é€šä¿¡åè®®ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦å¤ªå…³æ³¨ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ‰€ä»¥å’±ä»¬éœ€è¦åšçš„å°±æ˜¯æ‹¿åˆ°æ•°å­—è¯ä¹¦&lt;a href=&quot;http://kb.cnblogs.com/page/194742/&quot;&gt;æ•°å­—è¯ä¹¦åŠCA&lt;/a&gt;ï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;å‘å®˜æ–¹CAè®¤è¯æœºæ„ç”³è¯·è¯ä¹¦&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;è‡ªå»ºè¯ä¹¦ï¼Œé…ç½®ç»™æœåŠ¡å™¨&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç¬¬ä¸€ç§æ–¹æ³•æ˜¯æœ€ä¼˜çš„ï¼Œå»ºç«‹ç½‘ç«™çš„è¯ï¼Œç›´æ¥å°±ä¼šè¢«ä¿¡ä»»ã€‚è€ŒæœåŠ¡å™¨ä½œä¸ºç§»åŠ¨ç«¯appçš„æœåŠ¡å™¨æ—¶ï¼Œä¹Ÿä¸éœ€è¦ä¸ºATSåšè¿‡å¤šçš„é€‚é…ï¼ˆæ­£æ˜¯æˆ‘æ‰€éœ€è¦ç§¯ç´¯çŸ¥è¯†çš„æ–¹å‘ï¼‰ã€‚è™½ç„¶è¯´æƒå¨çš„æœºæ„è®¤è¯éƒ½æ˜¯éœ€è¦é’±çš„ï¼Œä½†æ˜¯å¦‚ä»Šä¹Ÿä¸ä¹å­˜åœ¨å…è´¹çš„ç¬¬ä¸‰æ–¹è®¤è¯æœºæ„ã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬äºŒç§æ–¹æ³•è™½ç„¶å¯¹äºappå’ŒæœåŠ¡å™¨é—´çš„é€šè®¯æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å¦‚æœä»ç½‘ç«™æ‰“å¼€é“¾æ¥æ—¶ä¼šå¼¹å‡ºä¸€ä¸ªè­¦å‘Šæé†’ï¼Œæé†’è¿™æ˜¯ä¸€ä¸ªä¸å—ä¿¡ä»»çš„ç½‘ç«™ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨è®¾ç½®ä¿¡ä»»æ‰è¡Œï¼Œè¿™ç§ä½“éªŒä¼šè®©ç”¨æˆ·æ„Ÿè§‰ç½‘ç«™ä¸å®‰å…¨ã€‚è€Œå®¢æˆ·ç«¯é…ç½®æ—¶éœ€è¦å°†info.plistæ–‡ä»¶ä¸­å°†App Transport Security Settingsä¸­çš„Allow Arbitrary Loadsè®¾ç½®ä¸ºYESæˆ–è€…åœ¨App Transport Security Settingsä¸‹æ·»åŠ ç™½åå•ï¼ˆæ–°å¢Exception Domainsé€‰é¡¹ï¼Œå°†è‡ªå·±æœåŠ¡å™¨çš„åŸŸåæ”¾è¿›å»ï¼‰ï¼Œè¿™é‡Œæˆ‘è¦è¯´çš„æ˜¯è®¸å¤šäººä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€æ˜¯ç›´æ¥å°†Allow Arbitrary Loadsè®¾ç½®ä¸ºYESï¼Œè¿™ç§è®¾ç½®ä¼šä¿¡ä»»å…¶ä»–æ‰€æœ‰çš„httpè¯·æ±‚ï¼Œç›¸å½“äºhttpsç™½åšäº†ï¼Œæ‰€ä»¥åè€…æ‰æ˜¯å¯å–çš„ã€‚&lt;/p&gt;

&lt;p&gt;è¿™é‡Œæœ‰ä¸€ä¸ªæ–¹æ³•å¯ä»¥å¿«é€Ÿæ£€æµ‹æœåŠ¡å™¨çš„httpsç‰¹æ€§æ˜¯å¦ç¬¦åˆATSçš„è¦æ±‚ï¼š
æ§åˆ¶å°è¾“å…¥&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nscurl --ats-diagnostics --verbose https://example.com
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;è¿™ä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;https://example.com&lt;/code&gt;å°±æ˜¯ä½ æƒ³æ£€æµ‹çš„åŸŸåï¼Œå’±ä»¬æ¥è¯•è¯•çŸ¥ä¹&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nscurl --ats-diagnostics --verbose https://www.zhihu.com
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;è¾“å‡ºå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Starting ATS Diagnostics

Configuring ATS Info.plist keys and displaying the result of HTTPS loads to https://www.zhihu.com.
A test will &quot;PASS&quot; if URLSession:task:didCompleteWithError: returns a nil error.
================================================================================

Default ATS Secure Connection

---
ATS Default Connection
ATS Dictionary:
{
}
Result : PASS
---

================================================================================

Allowing Arbitrary Loads

---
Allow All Loads
ATS Dictionary:
{
    NSAllowsArbitraryLoads = true;
}
Result : PASS
---

================================================================================

Configuring TLS exceptions for www.zhihu.com

---
TLSv1.2
ATS Dictionary:
{
    NSExceptionDomains =     {
        &quot;www.zhihu.com&quot; =         {
            NSExceptionMinimumTLSVersion = &quot;TLSv1.2&quot;;
        };
    };
}
Result : PASS
---

---
TLSv1.1
ATS Dictionary:
{
    NSExceptionDomains =     {
        &quot;www.zhihu.com&quot; =         {
            NSExceptionMinimumTLSVersion = &quot;TLSv1.1&quot;;
        };
    };
}
Result : PASS
---

---
TLSv1.0
ATS Dictionary:
{
    NSExceptionDomains =     {
        &quot;www.zhihu.com&quot; =         {
            NSExceptionMinimumTLSVersion = &quot;TLSv1.0&quot;;
        };
    };
}
Result : PASS
---

================================================================================

Configuring PFS exceptions for www.zhihu.com

---
Disabling Perfect Forward Secrecy
ATS Dictionary:
{
    NSExceptionDomains =     {
        &quot;www.zhihu.com&quot; =         {
            NSExceptionRequiresForwardSecrecy = false;
        };
    };
}
Result : PASS
---

================================================================================

Configuring PFS exceptions and allowing insecure HTTP for www.zhihu.com

---
Disabling Perfect Forward Secrecy and Allowing Insecure HTTP
ATS Dictionary:
{
    NSExceptionDomains =     {
        &quot;www.zhihu.com&quot; =         {
            NSExceptionAllowsInsecureHTTPLoads = true;
            NSExceptionRequiresForwardSecrecy = false;
        };
    };
}
Result : PASS
---

================================================================================

Configuring TLS exceptions with PFS disabled for www.zhihu.com

---
TLSv1.2 with PFS disabled
ATS Dictionary:
{
    NSExceptionDomains =     {
        &quot;www.zhihu.com&quot; =         {
            NSExceptionMinimumTLSVersion = &quot;TLSv1.2&quot;;
            NSExceptionRequiresForwardSecrecy = false;
        };
    };
}
Result : PASS
---

---
TLSv1.1 with PFS disabled
ATS Dictionary:
{
    NSExceptionDomains =     {
        &quot;www.zhihu.com&quot; =         {
            NSExceptionMinimumTLSVersion = &quot;TLSv1.1&quot;;
            NSExceptionRequiresForwardSecrecy = false;
        };
    };
}
Result : PASS
---

---
TLSv1.0 with PFS disabled
ATS Dictionary:
{
    NSExceptionDomains =     {
        &quot;www.zhihu.com&quot; =         {
            NSExceptionMinimumTLSVersion = &quot;TLSv1.0&quot;;
            NSExceptionRequiresForwardSecrecy = false;
        };
    };
}
Result : PASS
---

================================================================================

Configuring TLS exceptions with PFS disabled and insecure HTTP allowed for www.zhihu.com

---
TLSv1.2 with PFS disabled and insecure HTTP allowed
ATS Dictionary:
{
    NSExceptionDomains =     {
        &quot;www.zhihu.com&quot; =         {
            NSExceptionAllowsInsecureHTTPLoads = true;
            NSExceptionMinimumTLSVersion = &quot;TLSv1.2&quot;;
            NSExceptionRequiresForwardSecrecy = false;
        };
    };
}
Result : PASS
---

---
TLSv1.1 with PFS disabled and insecure HTTP allowed
ATS Dictionary:
{
    NSExceptionDomains =     {
        &quot;www.zhihu.com&quot; =         {
            NSExceptionAllowsInsecureHTTPLoads = true;
            NSExceptionMinimumTLSVersion = &quot;TLSv1.1&quot;;
            NSExceptionRequiresForwardSecrecy = false;
        };
    };
}
Result : PASS
---

---
TLSv1.0 with PFS disabled and insecure HTTP allowed
ATS Dictionary:
{
    NSExceptionDomains =     {
        &quot;www.zhihu.com&quot; =         {
            NSExceptionAllowsInsecureHTTPLoads = true;
            NSExceptionMinimumTLSVersion = &quot;TLSv1.0&quot;;
            NSExceptionRequiresForwardSecrecy = false;
        };
    };
}
Result : PASS
---
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°çŸ¥ä¹åœ¨æ‰€æœ‰æµ‹è¯•ä¸­çš„ç»“æœéƒ½æ˜¯PASSï¼ŒçŸ¥ä¹å¯¹ç”¨æˆ·çš„ä¿¡æ¯å®‰å…¨ä¿æŠ¤å·¥ä½œåšå¾—è¿˜æ˜¯ä¸é”™çš„ï¼Œèµï¼è‡ªå·±çš„æœåŠ¡å™¨é…ç½®å¥½äº†httpsåä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªæ¥è¿›è¡Œå°è¯•ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;iOSç«¯å¦‚ä½•å®ç°https&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åŸºäºå¯¹HTTPSè¿è¡Œæœºåˆ¶çš„ç†è§£ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨iOSå®¢æˆ·ç«¯å®ç°ä¸æœåŠ¡å™¨çš„httpsé€šä¿¡ï¼Œå‰ææ¡ä»¶æ˜¯ä½ çš„æœåŠ¡å™¨æ˜¯ä¸€ä¸ªæä¾›äº†httpsçš„æœåŠ¡å™¨ã€‚å¦‚æœå‰æå¾—ä»¥æ»¡è¶³ï¼Œé‚£ä¹ˆiOSå®¢æˆ·ç«¯å°±éœ€è¦å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ç´¢è¦å…¬é’¥ï¼Œè€ŒåéªŒè¯å…¬é’¥ï¼Œç„¶åè¿›è¡Œæ¡æ‰‹ï¼Œæœ€åå¼€å§‹åŠ å¯†é€šä¿¡ã€‚é‚£ä¹ˆï¼Œå…·ä½“æ€ä¹ˆåšå‘¢ï¼Ÿéš¾å€’è¿™äº›éƒ½éœ€è¦æˆ‘è‡ªå·±å®ç°å—ï¼Ÿè‚¯å®šä¸æ˜¯çš„ï¼Œè¿™ç§åŸºç¡€æ€§å·¥ä½œï¼Œè‹¹æœæ—©å°±åšå¥½äº†ï¼Œè‘—åçš„ç¬¬ä¸‰æ–¹åº“AFNetworkingä¹Ÿæ—©å°±åšå¥½äº†ã€‚&lt;/p&gt;

&lt;p&gt;1.åˆ é™¤æ‰info.plistæ–‡ä»¶ä¸­App Transport Security SettingsåŠå…¶å­é¡¹Allow Arbitrary Loadsï¼Œè®©ATSæ¢å¤åˆ°é»˜è®¤çŠ¶æ€ã€‚&lt;/p&gt;

&lt;p&gt;2.ä¿®æ”¹ä¸»åŸŸåä¸ºé¡¹ç›®çš„httpsåŸŸå&lt;/p&gt;

&lt;p&gt;ç”±æ­¤å¯çŸ¥ï¼Œå¯¹äºç¬¦åˆATSè¦æ±‚çš„HTTPSæœåŠ¡å™¨ï¼Œåœ¨iOSç«¯ä¸éœ€è¦å¯¹ATSåšç‰¹æ®Šçš„é€‚é…å°±èƒ½å’ŒHTTPSæœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚è€Œè¦ç¬¦åˆATSè¦æ±‚ï¼Œåˆ™éœ€è¦è€è€å®å®åœ°åˆ›å»ºè¯ä¹¦è¯·æ±‚ï¼Œç„¶ååˆ°æƒå¨æœºæ„è®¤è¯ï¼Œéšä¹‹é…ç½®åˆ°æœåŠ¡å™¨ã€‚æ˜¯ä¸æ˜¯è¶…çº§ç®€å•ï¼Ÿ&lt;/p&gt;

&lt;p&gt;å¯¹äºè‡ªå»ºè¯ä¹¦çš„æ–¹æ³•å’Œé…ç½®ä¸‹ç¯‡æ–‡ç« å†è®²ã€‚&lt;/p&gt;

</description>
        <pubDate>Thu, 11 May 2017 16:08:13 +0800</pubDate>
        <link>/2017/05/iOS%E7%9A%84https%E8%AE%A4%E8%AF%81-%E4%B8%80/</link>
        <guid isPermaLink="true">/2017/05/iOS%E7%9A%84https%E8%AE%A4%E8%AF%81-%E4%B8%80/</guid>
        
        <category>ç½‘ç»œ</category>
        
        <category>https</category>
        
        <category>iOSçš„httpsè®¤è¯(ä¸€)</category>
        
        
        <category>study</category>
        
      </item>
    
      <item>
        <title>iOSçš„é™æ€ä¸åŠ¨æ€å†…å­˜åˆ†æ</title>
        <description>&lt;p&gt;è¿‘æ®µæ—¶é—´appå¤„äºä¼˜åŒ–é˜¶æ®µï¼Œå‘ç°åœ¨ä¸€äº›åˆ—è¡¨é¡µé¢æŸ¥çœ‹æ•°æ®ä¹…ä¸€ç‚¹å°±ä¼šå‡ºç°è«åå…¶å¦™çš„å´©æºƒã€‚è¿ä¸ŠXcodeä¸€æŸ¥ï¼Œä¹Ÿä¸æ˜¯å¿…ç°ï¼Œä½†é¢‘ç‡æ¯”è¾ƒé«˜ï¼Œè€Œä¸”æ²¡æœ‰å´©æºƒæç¤ºï¼Œæ˜¯æ‰‹æœºå’ŒXcodeç›´æ¥æ–­å¼€è¿æ¥ã€‚å†çœ‹ç€æ€§èƒ½æŒ‡ç¤ºè¿›è¡Œæ“ä½œï¼Œæœä¸å…¶ç„¶ï¼Œæ¯æ¬¡å†…å­˜é£™å‡åˆ°ä¸€å®šç¨‹åº¦å°±ä¼šå´©æºƒã€‚ä¸€ä¸ªappæƒ³è¦èµ°å‘æˆç†Ÿï¼Œè¿™ç§é—®é¢˜å¿…é¡»è§£å†³ï¼Œè¿™é‡Œå°±éœ€è¦è°ˆåˆ°iOSçš„é™æ€ä¸åŠ¨æ€å†…å­˜åˆ†æ&lt;/p&gt;

&lt;h3 id=&quot;section&quot;&gt;é™æ€å†…å­˜åˆ†æ&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ä¼˜ç‚¹&lt;/code&gt;ï¼šåˆ†æå†…å­˜éå¸¸å¿«ï¼Œå·²ç»å¯ä»¥å¯¹æ•´ä¸ªé¡¹ç›®çš„å†…å­˜è¿›è¡Œåˆ†æã€‚&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ç¼ºç‚¹&lt;/code&gt;ï¼šä¸è¿è¡Œç¨‹åºï¼Œç›´æ¥å¯¹ä»£ç è¿›è¡Œåˆ†æã€‚æ ¹æ®ä»£ç çš„ä¸Šä¸‹æ–‡è¯­æ³•ç»“æ„ï¼Œçœ‹è¯­æ³•æ˜¯å¦æœ‰é—®é¢˜ã€‚ï¼ˆä¸å¤Ÿå‡†ç¡®ï¼Œä½†æ˜¯å¦‚æœé€šè¿‡é™æ€å†…å­˜åˆ†æï¼Œæœ‰æç¤ºå‡ºç°äº†å†…å­˜æ³„éœ²ï¼Œéœ€è¦é€šè¿‡åˆ†æä»£ç ä¸Šä¸‹æ–‡æŸ¥çœ‹æ˜¯å¦æœ‰å†…å­˜æ³„éœ²ï¼‰&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;å¿«æ·é”®&lt;/code&gt;ï¼šcommand +shift +b&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;è¿›è¡Œæ–¹å¼&lt;/code&gt;ï¼šProduct â€“ &amp;gt; Analyze&lt;/p&gt;

&lt;h3 id=&quot;instrument&quot;&gt;åŠ¨æ€å†…å­˜åˆ†æï¼ˆInstrumentï¼‰&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ä¼˜ç‚¹&lt;/code&gt;ï¼šçœŸæ­£è¿è¡Œèµ·æ¥çš„ç¨‹åºï¼Œå¹¶ä¸”å¯ä»¥å¯¹æŸä¸€ä¸ªæ“ä½œæ¥å…·ä½“åˆ†æï¼Œå½“ç”¨æˆ·åšäº†æŸä¸€ä¸ªæ“ä½œæ—¶ï¼Œè¯¥æ“ä½œæ˜¯å¦äº§ç”Ÿäº†å†…å­˜æ³„éœ²ï¼ˆåˆ†å‚å‡†ç¡®ï¼Œå¦‚æœæç¤ºæœ‰å†…å­˜æ³„éœ²ï¼ŒåŸºæœ¬å¯ä»¥è¯´æ˜ä»£ç æœ‰é—®é¢˜ï¼‰&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ç¼ºç‚¹&lt;/code&gt;ï¼šåˆ†æé€Ÿåº¦éå¸¸æ…¢ï¼Œéœ€è¦ä¸€æ­¥ä¸€æ­¥æ¥åˆ†æä»£ç æ˜¯å¦æœ‰é—®é¢˜ï¼Œåˆ‡å¯èƒ½åœ¨åˆ†æè¿‡ç¨‹ä¸­æœ‰é—æ¼ä»£ç ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;è¿›è¡Œæ–¹å¼&lt;/code&gt;ï¼šProduct â€“&amp;gt; Profile â€“&amp;gt;Leaks â€“&amp;gt; é€‰æ‹©æƒ³è¦è¿è¡Œçš„é¡¹ç›® â€“&amp;gt; Record&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/266345-5cc73c61f7ae76c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300&quot; width=&quot;300&quot; height=&quot;200&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/266345-28c2b43923fe13da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300&quot; width=&quot;400&quot; height=&quot;200&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/266345-48b146c5196c07d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300&quot; width=&quot;400&quot; height=&quot;200&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è¿™æ ·å°±å¯ä»¥å¼€å§‹åŠ¨æ€æ£€æµ‹ä¸€ä¸ªé¡¹ç›®æ˜¯å¦å­˜åœ¨å†…å­˜æ³„éœ²äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼šæˆ‘ä»¬éœ€è¦è¿›è¡Œæ“ä½œè®©ç³»ç»Ÿä¸æ–­å»æ‰§è¡Œæ‰€è¦æ£€æµ‹çš„ä»£ç æ˜¯å¦å­˜åœ¨å†…å­˜æ³„éœ²ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœæœ‰å†…å­˜æ³„éœ²çš„æƒ…å†µå°±ä¼šå‡ºç°ä¸‹å›¾æƒ…å†µ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/266345-be4e19b457a6baf9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300&quot; width=&quot;400&quot; height=&quot;200&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è¿™é‡Œæˆ‘ä»¬åœ¨å³ä¾§ Stack Trace æ‹¦ä¸‹ç‚¹å‡»æˆ‘ä»¬æ‰€åˆ›å»ºçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å¸¦äººåƒçš„æ–¹æ³•ï¼Œè¿™æ ·å°±èƒ½å®šä½åˆ°æ³„éœ²çš„ä½ç½®äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/266345-7fc50ba21788fbcd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300&quot; width=&quot;300&quot; height=&quot;50&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;é€‰ä¸­æŸä¸€ä¸ªæ³„éœ²ä½ç½®ï¼Œä¹‹åç‚¹å‡»å³ä¸Šè§’ Xcode çš„å›¾æ ‡ç›´æ¥å›åˆ° Xcode ä»£ç ä¸­è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ ·æˆ‘ä»¬åŠ¨æ€å†…å­˜åˆ†æå°±å®Œæˆäº†&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/266345-5812ead6f94787d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300&quot; width=&quot;300&quot; height=&quot;100&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼šæˆ‘ä»¬å¯èƒ½ä¼šçœ‹åˆ°è¿™æ ·çš„æƒ…å†µï¼Œ All Heap Allocations æ˜¯ç¨‹åºçœŸå®çš„å†…å­˜åˆ†é…æƒ…å†µï¼ŒAll Anonymous VMåˆ™æ˜¯ç³»ç»Ÿä¸ºç¨‹åºåˆ†é…çš„è™šæ‹Ÿå†…å­˜ï¼Œä¸ºçš„å°±æ˜¯å½“ç¨‹åºæœ‰éœ€è¦çš„æ—¶å€™ï¼Œèƒ½å¤ŸåŠæ—¶ä¸ºç¨‹åºæä¾›è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œè€Œä¸ä¼šç°ç”¨ç°åˆ›å»º&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/266345-34d339d54700e6a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/300&quot; width=&quot;300&quot; height=&quot;30&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

</description>
        <pubDate>Tue, 09 May 2017 16:08:13 +0800</pubDate>
        <link>/2017/05/iOS%E7%9A%84%E9%9D%99%E6%80%81%E4%B8%8E%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90/</link>
        <guid isPermaLink="true">/2017/05/iOS%E7%9A%84%E9%9D%99%E6%80%81%E4%B8%8E%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90/</guid>
        
        <category>ä¼˜åŒ–</category>
        
        <category>å†…å­˜</category>
        
        <category>iOSçš„é™æ€ä¸åŠ¨æ€å†…å­˜åˆ†æ</category>
        
        
        <category>study</category>
        
      </item>
    
      <item>
        <title>æ£€æµ‹appæ€§èƒ½å¹¶å®ç°ä¼˜åŒ–-å›¾å½¢æ€§èƒ½ç¯‡</title>
        <description>&lt;p&gt;å¾ˆå¤šå°šæœªæˆç†Ÿçš„Appéƒ½ä¼šå­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼Œå¦‚å¡é¡¿ã€è€—ç”µã€å†…å­˜ç®¡ç†ç­‰ç­‰ï¼ŒåŒ…æ‹¬æˆ‘ä»¬é¡¹ç›®Appã€‚ä»Šå¤©æœ‰ç©ºé—²æ—¶é—´ï¼Œå°±å†³å®šå¯¹éƒ¨åˆ†æ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼Œå½“ç„¶å·¥å…·ä¸»è¦å°±æ˜¯ç”¨Xcodeè‡ªå¸¦çš„Core Animationäº†ã€‚è¯ä¸å¤šè¯´ï¼Œå¼€å¹²ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Core Animationå¯åŠ¨è¿è¡Œ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;1.æ‰“å¼€Xcodeå¯¹å½“å‰é¡¹ç›®Profileï¼Œç‚¹å‡»Productå†ç‚¹å‡»Profile&lt;/p&gt;

&lt;p&gt;2.è¿™æ—¶å°±ä¼šæ‰“å¼€ Profiling Template é€‰é¡¹å¯¹è¯æ¡†ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1709525-5c7213dbefc19c86.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; width=&quot;400&quot; height=&quot;250&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;3.é€‰æ‹©Core Animationå³å¯&lt;/p&gt;

&lt;p&gt;4.ç‚¹å‡»çº¢è‰²è¿è¡ŒæŒ‰é’®å¯åŠ¨Appï¼Œéšåæ“ä½œAppå°±èƒ½çœ‹åˆ°FPSå’ŒCPUç­‰æ€§èƒ½ä¿¡æ¯äº†&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä½†æ˜¯ä½ çœ‹åˆ°è¿™äº›ä¿¡æ¯äº†ï¼Œå‘ç°äº†é—®é¢˜ï¼Œè¯¥å¦‚ä½•ä¼˜åŒ–å‘¢ï¼Œä¸‹é¢å°±ç”¨Core Animationæ¥ä¸€ä¸ªä¸ªä¼˜åŒ–&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨å³ä¸‹è§’é¢æ¿çš„ Display Settings åŒºåŸŸï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¤šä¸ª Debug Options&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1709525-4c4211d0669f0082.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; width=&quot;250&quot; height=&quot;300&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹æ¥ä¸€ä¸ªä¸€ä¸ªçœ‹ã€‚&lt;/p&gt;

&lt;h4 id=&quot;color-blended-layers&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Color Blended Layers&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;è¿™ä¸ªé€‰é¡¹é€‰é¡¹åŸºäºæ¸²æŸ“ç¨‹åº¦å¯¹å±å¹•ä¸­çš„æ··åˆåŒºåŸŸè¿›è¡Œç»¿åˆ°çº¢çš„é«˜äº®æ˜¾ç¤ºï¼Œè¶Šçº¢è¡¨ç¤ºæ€§èƒ½è¶Šå·®ï¼Œä¼šå¯¹å¸§ç‡ç­‰æŒ‡æ ‡é€ æˆè¾ƒå¤§çš„å½±å“ã€‚çº¢è‰²é€šå¸¸æ˜¯ç”±äºå¤šä¸ªåŠé€æ˜å›¾å±‚å åŠ å¼•ï¼Œè€Œä¸”æ— ç”¨çš„å›¾å±‚å åŠ è¶Šå¤šï¼Œé¢œè‰²è¶Šçº¢ã€‚æ‰€ä»¥å¯¹è¿™ä¸ªåšæ€§èƒ½ä¼˜åŒ–å°±æ˜¯å°½é‡ä¿è¯å›¾å±‚å åŠ å°‘ï¼Œå¹¶å°½é‡å‡å°‘å¯¹é€æ˜åº¦çš„ä½¿ç”¨ã€‚ä¸‹é¢å°±æ˜¯ä¼˜åŒ–åçš„Appç•Œé¢ä¸å¾®ä¿¡æœ‹å‹åœˆçš„å¯¹æ¯”ï¼Œå¯ä»¥çœ‹å‡ºè¿™ä¸ªæ€§èƒ½æ¯”å¾®ä¿¡è¿˜æ›´èƒœä¸€ç­¹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1709525-4c4211d0669f0082.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; width=&quot;200&quot; height=&quot;300&quot; alt=&quot;photos&quot; /&gt;
&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1709525-765097aa49b36c8f.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; width=&quot;200&quot; height=&quot;300&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;color-hits-green-and-misses-red&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Color Hits Green and Misses Red&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;å½“ UIView.layer.shouldRasterize = YES æ—¶ï¼Œè€—æ—¶çš„å›¾ç‰‡ç»˜åˆ¶ä¼šè¢«ç¼“å­˜ï¼Œå¹¶å½“åšä¸€ä¸ªç®€å•çš„æ‰å¹³å›¾ç‰‡æ¥å‘ˆç°ã€‚è¿™æ—¶å€™ï¼Œå¦‚æœé¡µé¢çš„å…¶ä»–åŒºå—(æ¯”å¦‚ UITableViewCell çš„å¤ç”¨)ä½¿ç”¨ç¼“å­˜ç›´æ¥å‘½ä¸­ï¼Œå°±æ˜¾ç¤ºç»¿è‰²ï¼Œåä¹‹ï¼Œå¦‚æœä¸å‘½ä¸­ï¼Œè¿™æ—¶å°±æ˜¾ç¤ºçº¢è‰²ã€‚çº¢è‰²è¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®ã€‚å› ä¸ºæ …æ ¼åŒ–ç”Ÿæˆç¼“å­˜çš„è¿‡ç¨‹æ˜¯æœ‰å¼€é”€çš„ï¼Œå¦‚æœç¼“å­˜èƒ½è¢«å¤§é‡å‘½ä¸­å’Œæœ‰æ•ˆä½¿ç”¨ï¼Œåˆ™æ€»ä½“ä¸Šä¼šé™ä½å¼€é”€ï¼Œåä¹‹åˆ™æ„å‘³ç€è¦é¢‘ç¹ç”Ÿæˆæ–°çš„ç¼“å­˜ï¼Œè¿™ä¼šè®©æ€§èƒ½é—®é¢˜é›ªä¸ŠåŠ éœœã€‚
æ‰€ä»¥è¿™é‡Œçš„è¿™ä¸ªç¼“å­˜å°±éœ€è¦æ…é‡ä½¿ç”¨ï¼Œè€Œæˆ‘ä»¬AppåŒ…æ‹¬å¾®ä¿¡QQæ”¯ä»˜å®ç­‰æˆ‘çœ‹ä¹ŸåŸºæœ¬æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªæ–¹å¼ã€‚è€Œæˆ‘ä»¬Appçš„statusBarä¼šç»å¸¸é—ªçº¢è‰²ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªCPUå’ŒFPSçš„å®æ—¶æŸ¥çœ‹å·¥å…·ï¼Œéœ€è¦ç»å¸¸åˆ·æ–°æ˜¾ç¤ºï¼Œæ‰€ä»¥å°±æ²¡å•¥è§£å†³çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1709525-12b7a6991f4f3798.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; width=&quot;200&quot; height=&quot;300&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;color-copied-images&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Color Copied Images&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;å¯¹äº GPU ä¸æ”¯æŒçš„è‰²å½©æ ¼å¼çš„å›¾ç‰‡åªèƒ½ç”± CPU æ¥å¤„ç†ï¼ŒæŠŠè¿™æ ·çš„å›¾ç‰‡æ ‡ä¸ºè“è‰²ã€‚è“è‰²è¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®ã€‚å› ä¸ºï¼Œæˆ‘ä»¬ä¸å¸Œæœ›åœ¨æ»šåŠ¨è§†å›¾çš„æ—¶å€™ï¼Œç”± CPU æ¥å¤„ç†å›¾ç‰‡ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¹ä¸»çº¿ç¨‹é€ æˆé˜»å¡ã€‚çœ‹äº†Appå¥½å‡ ä¸ªé¡µé¢ï¼Œå‘ç°æ ¹æœ¬ä¸ä¼šå‡ºç°è¿™é‡Œæ‰€è¯´çš„è“è‰²ï¼Œä½†æˆ‘æŸ¥çœ‹æ”¯ä»˜å®QQå°±å‘ç°äº†å‡ ä¸ªè“è‰²çš„åœ°æ–¹ï¼Œä¸çŸ¥é“æ˜¯ä»–ä»¬æœ‰ç‰¹æ®Šçš„è€ƒè™‘è¿˜æ˜¯æ²¡å‘ç°è¿™é—®é¢˜ï¼Œä½†é—®é¢˜ä¹Ÿç‰¹å°‘ï¼Œå½±å“ä¸å¤§ã€‚å›¾å°±ä¸ä¸Šäº†&lt;/p&gt;

&lt;h4 id=&quot;color-non-standard-surface-formats&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Color Non-Standard Surface Formats&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;è¿™ä¸ªæ€§èƒ½å‘ç°åŸºæœ¬ä¸Šæ²¡æœ‰èµ„æ–™èƒ½æŸ¥åˆ°ï¼Œæ‰“å¼€è¿™ä¸ªæ€§èƒ½æ£€æµ‹åï¼Œå‘ç°Appä¸Šå¾ˆå¤šæµ…ç°è‰²è‰²å—ï¼Œå¹¶ä¸”æœ‰ä¸ªè§„å¾‹ï¼Œå®ƒä»¬éƒ½æ˜¯æ²¡æœ‰è®¾ç½®èƒŒæ™¯è‰²çš„åŒºåŸŸï¼Œåæ¥è‡ªå·±è®¾ç½®äº†èƒŒæ™¯è‰²å°±æ²¡æœ‰è‰²å—äº†ï¼Œä½†æˆ‘ä¸çŸ¥é“æ˜¯å‰è€…è¿˜æ˜¯åè€…æ€§èƒ½å¥½ï¼Œå¸Œæœ›çŸ¥é“çš„äººè§£ç­”ä¸€ä¸‹ã€‚ä½†æˆ‘å‘ç°QQæ”¯ä»˜å®è¿™äº›å¤§å‹çš„Appä¹Ÿæ²¡æœ‰å¯¹è¿™äº›åšå¤„ç†ï¼Œè€Œä¸”å‘ç°è‹¹æœåŸç”Ÿç•Œé¢ä¹Ÿæœ‰å¾ˆå¤šè¿™ç§ç°è‰²è‰²å—ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæ²¡æœ‰å¯¹å½“å‰Appçš„è¿™äº›é—®é¢˜åšå¤„ç†ï¼Œä¸Šä¸€ç»„å›¾çœ‹çœ‹æ•ˆæœã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1709525-d42c2ca9e40002d6.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; width=&quot;200&quot; height=&quot;300&quot; alt=&quot;photos&quot; /&gt;
&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1709525-bcc1746f40cdae32.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; width=&quot;200&quot; height=&quot;300&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;color-immediately&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Color Immediately&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;é€šå¸¸ Core Animation Instruments ä»¥æ¯æ¯«ç§’ 10 æ¬¡çš„é¢‘ç‡æ›´æ–°å›¾å±‚è°ƒè¯•é¢œè‰²ã€‚å¯¹æŸäº›æ•ˆæœæ¥è¯´ï¼Œè¿™æ˜¾ç„¶å¤ªæ…¢äº†ã€‚è¿™ä¸ªé€‰é¡¹å°±å¯ä»¥ç”¨æ¥è®¾ç½®æ¯å¸§éƒ½æ›´æ–°ï¼ˆå¯èƒ½ä¼šå½±å“åˆ°æ¸²æŸ“æ€§èƒ½ï¼Œè€Œä¸”ä¼šå¯¼è‡´å¸§ç‡æµ‹é‡ä¸å‡†ï¼Œæ‰€ä»¥ä¸è¦ä¸€ç›´éƒ½è®¾ç½®å®ƒï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªè¾…åŠ©è°ƒè¯•å·¥å…·ï¼Œæœ¬èº«æ˜¯æ²¡æœ‰å•¥æ•ˆæœçš„ï¼Œéœ€è¦è”åˆå…¶ä»–è°ƒè¯•ç±»åˆ«ã€‚&lt;/p&gt;

&lt;h4 id=&quot;color-misaligned-images&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Color Misaligned Images&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;è¿™ä¸ªé€‰é¡¹æ£€æŸ¥äº†å›¾ç‰‡æ˜¯å¦è¢«ç¼©æ”¾ï¼Œä»¥åŠåƒç´ æ˜¯å¦å¯¹é½ã€‚è¢«æ”¾ç¼©çš„å›¾ç‰‡ä¼šè¢«æ ‡è®°ä¸ºé»„è‰²ï¼Œåƒç´ ä¸å¯¹é½åˆ™ä¼šæ ‡æ³¨ä¸ºç´«è‰²ã€‚é»„è‰²ã€ç´«è‰²è¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®ã€‚ä¸»è¦æ˜¯å°†æ§ä»¶æŒ‰ç…§å›¾ç‰‡å¤§å°æ¥è®¾å®šå¤§å°ï¼Œå¦‚ç‚¹èµã€è¯„è®ºã€åˆ†å‰²çº¿å’ŒèŠå¤©æŒ‰é’®ï¼Œè¿˜æœ‰å°±æ˜¯å¤´åƒå›¾ç‰‡åœ¨ä¸‹è½½çš„æ—¶å€™å°±ä»cdnä¸‹è½½è‡ªå·±éœ€è¦çš„å¤§å°ï¼Œè¿™æ ·å›¾ç‰‡çš„é»„è‰²ç¼©æ”¾é—®é¢˜å°±æ²¡äº†ï¼›å†å°±æ˜¯æ§ä»¶çš„å®½é«˜æœ€å¥½æ˜¯æ•´æ•°,å› ä¸ºè‹¹æœçš„å±å¹•æœ€å°å•ä½æ˜¯1åƒç´ ï¼Œå¦‚æœæœ‰å°æ•°äº†ï¼Œè®¾å¤‡æ˜¾ç¤ºå°±ä¼šå¤šæ¬¡å†è®¡ç®—ï¼Œå†é€‰æ‹©ä¸€ä¸ªæ•´æ•°åƒç´ æ¥æ˜¾ç¤ºã€‚è€Œå•å¼ å¤§å›¾ç”±äºéœ€æ±‚åŸå› ï¼Œæš‚æ—¶æ²¡æœ‰åšå¤„ç†ã€‚ä¸‹é¢å°±æ˜¯å‰åå¯¹æ¯”å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1709525-cd7afd6abffcaa27.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; width=&quot;200&quot; height=&quot;300&quot; alt=&quot;photos&quot; /&gt;
&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1709525-595fe2819f937070.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; width=&quot;200&quot; height=&quot;300&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;color-offscreen-rendered-yellow&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Color Offscreen-Rendered Yellow&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;è¿™ä¸ªé€‰é¡¹ä¼šæŠŠé‚£äº›ç¦»å±æ¸²æŸ“çš„å›¾å±‚æ˜¾ç¤ºä¸ºé»„è‰²ã€‚é»„è‰²è¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®ã€‚è¿™äº›æ˜¾ç¤ºä¸ºé»„è‰²çš„å›¾å±‚å¾ˆå¯èƒ½éœ€è¦ç”¨ shadowPath æˆ–è€… shouldRasterize æ¥ä¼˜åŒ–ã€‚è¿™é‡Œåªéœ€è¦å°‘ä½¿ç”¨å›¾å±‚çš„clipsToBoundså’Œlayerå±‚çš„masksToBoundsæ–¹æ³•å³å¯ã€‚&lt;/p&gt;

&lt;h4 id=&quot;color-compositing-fast-path-blue&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;color compositing fast-path blue&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;å®˜æ–¹è¯´æ˜ï¼šâ€œPlaces a blue overlay over content that is detached from the compositor.â€æ ‡è®°ç”±ç¡¬ä»¶ç»˜åˆ¶çš„è·¯å¾„ä¸ºè“è‰²ï¼Œè“è‰²è¶Šå¤šè¶Šå¥½ï¼Œå¯ä»¥å¯¹ç›´æ¥ä½¿ç”¨OpenGLç»˜åˆ¶çš„å›¾å±‚è¿›è¡Œé«˜äº®ã€‚å¯¹OpenGLæ²¡ä»€ä¹ˆç ”ç©¶ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡åŠæ³•ç»™å‡ºæ–¹æ³•ï¼Œå¤§å®¶åªéœ€è¦è®°ä½è“è‰²è¶Šå¤šè¶Šå¥½å°±okã€‚&lt;/p&gt;

&lt;h4 id=&quot;flash-updated-regions&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Flash Updated Regions&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;è¿™ä¸ªé€‰é¡¹ä¼šæŠŠé‡ç»˜çš„å†…å®¹æ˜¾ç¤ºä¸ºé»„è‰²ã€‚ä¸è¯¥å‡ºç°çš„é»„è‰²è¶Šå¤šï¼Œæ€§èƒ½è¶Šå·®ã€‚é€šå¸¸æˆ‘ä»¬å¸Œæœ›åªæ˜¯æ›´æ–°çš„éƒ¨åˆ†è¢«æ ‡è®°å®Œé»„è‰²ã€‚å½“ä½ æ»‘åŠ¨appè§†å›¾çš„æ—¶å€™å±å¹•å°±æ˜¯é»„è‰²çš„ï¼Œå»ºè®®å¤§å®¶å°‘ç”¨è¿™ä¸ªè°ƒè¯•ï¼Œå› ä¸ºâ€”â€”&amp;gt;é—ªå¾—çœ¼ç›ç–¼ï¼&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;OpenGL ES Analysis&lt;/code&gt;æ¥ç›‘æµ‹å›¾å½¢çš„ç›¸å…³æ€§èƒ½ã€‚è°¢è°¢æ”¯æŒï¼&lt;/p&gt;

</description>
        <pubDate>Wed, 29 Mar 2017 16:08:13 +0800</pubDate>
        <link>/2017/03/%E6%A3%80%E6%B5%8Bapp%E6%80%A7%E8%83%BD%E5%B9%B6%E5%AE%9E%E7%8E%B0%E4%BC%98%E5%8C%96-%E5%9B%BE%E5%BD%A2%E6%80%A7%E8%83%BD%E7%AF%87/</link>
        <guid isPermaLink="true">/2017/03/%E6%A3%80%E6%B5%8Bapp%E6%80%A7%E8%83%BD%E5%B9%B6%E5%AE%9E%E7%8E%B0%E4%BC%98%E5%8C%96-%E5%9B%BE%E5%BD%A2%E6%80%A7%E8%83%BD%E7%AF%87/</guid>
        
        <category>ä¼˜åŒ–</category>
        
        <category>æ€§èƒ½</category>
        
        <category>æ£€æµ‹appæ€§èƒ½å¹¶å®ç°ä¼˜åŒ–-å›¾å½¢æ€§èƒ½ç¯‡</category>
        
        
        <category>study</category>
        
      </item>
    
      <item>
        <title>ä»¿å¾®ä¿¡æœ‹å‹åœˆè§†é¢‘å‰ªåˆ‡åŠŸèƒ½</title>
        <description>&lt;p&gt;å†™åœ¨å‰é¢&lt;/p&gt;

&lt;p&gt;å…¬å¸é¡¹ç›®æœ€è¿‘æœ‰ä¸ªå°è§†é¢‘åŠŸèƒ½ï¼Œä¸Šä¼ çš„è§†é¢‘æœ€é•¿åªæœ‰15ç§’ï¼Œæ‰€ä»¥éœ€è¦å®ç°ä¸€ä¸ªè§†é¢‘å‰ªè¾‘çš„åŠŸèƒ½ã€‚å‘ç°å¾®ä¿¡æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œä¾¿å‡†å¤‡ä»¿å¾®ä¿¡çš„äº¤äº’å†™ä¸€ä¸ªï¼Œç»“æœé‡åˆ°ä¸å°‘å‘ï¼Œåˆ†äº«ç»™å¤§å®¶è®©å¤§å®¶å°‘èµ°å¼¯è·¯ã€‚æ’¸èµ·è¢–å­è¯´å¹²å°±å¹²ã€‚&lt;/p&gt;

&lt;p&gt;åˆ†æéœ€æ±‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å…ˆçœ‹ä¸€çœ‹å¾®ä¿¡çš„ç•Œé¢&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1709525-d6fc6ea37b3fd2f3.PNG?imageMogr2/auto-orient/strip&quot; width=&quot;200&quot; height=&quot;350&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;å¾®ä¿¡è§†é¢‘è£å‰ªç•Œé¢&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;1.é¡µé¢ä¸‹éƒ¨æ‹–åŠ¨å·¦è¾¹å’Œå³è¾¹çš„ç™½è‰²ç«–æ¡æ§åˆ¶å‰ªåˆ‡è§†é¢‘çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œé¢„è§ˆç•Œé¢è·Ÿéšæ‹–åŠ¨ä½ç½®è·³åˆ°è§†é¢‘ç›¸åº”å¸§ç”»é¢,æ§åˆ¶è§†é¢‘é•¿åº¦æœ€é•¿15ç§’ï¼Œæœ€çŸ­5ç§’&lt;/p&gt;

&lt;p&gt;2.æ‹–åŠ¨ä¸‹éƒ¨å›¾ç‰‡é¢„è§ˆæ¡ï¼Œè§†é¢‘é¢„è§ˆç”»é¢è·³è½¬åˆ°å·¦è¾¹ç™½æ¡åœç•™å¤„çš„å¸§ç”»é¢&lt;/p&gt;

&lt;p&gt;3.ä¸‹éƒ¨æ“ä½œåŒºåŸŸæ‹–åŠ¨æ“ä½œæ—¶ï¼Œè§†é¢‘æš‚åœï¼Œæ¾æ‰‹åè§†é¢‘æ’­æ”¾ï¼Œæ’­æ”¾å†…å®¹ä¸ºä¸¤ä¸ªç™½æ¡ä¹‹é—´çš„å†…å®¹ï¼Œå¯ä»¥å¾ªç¯æ’­æ”¾&lt;/p&gt;

&lt;p&gt;4.ç•Œé¢çš„â€œå–æ¶ˆâ€è¿”å›ï¼Œâ€œç¡®å®šâ€åè£å‰ªè§†é¢‘è¾“å‡º&lt;/p&gt;

&lt;p&gt;å…ˆä¸Šä¸€ä¸ªæˆ‘åšå®Œçš„æ•ˆæœæˆªå›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1709525-e37e40c9c1aa40d0.jpg?imageMogr2/auto-orient/strip&quot; width=&quot;200&quot; height=&quot;350&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä»¿ç…§æ•ˆæœå›¾&lt;/p&gt;

&lt;p&gt;æˆ‘è‡ªå·±è®¾è®¡çš„æ§åˆ¶æ¡è·Ÿå¾®ä¿¡ç•¥æœ‰ä¸åŒï¼Œå¾®ä¿¡æ˜¯æœ€é•¿æ—¶é—´æ—¶å€™å·¦å³ä¸¤ä¸ªç™½è‰²ç«–æ¡ç¦»è¾¹æ¡†éƒ½è¿˜æœ‰ä¸€ç‚¹è·ç¦»ï¼Œæˆ‘è¿™é‡Œè®¾è®¡çš„æ˜¯ä¸¤è¾¹ç™½æ¡éƒ½è´´è¾¹æ¡†ï¼Œè¿”å›æŒ‰é’®å’Œç¡®å®šè£å‰ªæŒ‰é’®ä¹Ÿä¸åŒã€‚å…¶å®ä¹Ÿæ²¡å·®ï¼Œè¦è¯´å¾®ä¿¡é‚£æ ·è®¾è®¡æœ‰ç‰¹æ®Šè€ƒè™‘çš„è¯ï¼Œæˆ‘åªèƒ½è¯´æˆ‘ä¸æ˜¯äº¤äº’å’Œè§†è§‰è®¾è®¡å¸ˆğŸ˜³&lt;/p&gt;

&lt;h3 id=&quot;section&quot;&gt;å®ç°&lt;/h3&gt;

&lt;p&gt;1.æˆ‘è¿™é‡Œå®Œæ•´çš„æ‹–åŠ¨é€‰æ‹©è§†å›¾æ˜¯å°è£…çš„ä¸€ä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;view&lt;/code&gt;ï¼Œä¸Šé¢æ”¾ä¸€ä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;scrollView&lt;/code&gt;æ¥å±•ç¤ºå°çš„é¢„è§ˆå›¾ç‰‡ï¼Œå†ä¸Šé¢æ”¾ä¸¤ä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;image&lt;/code&gt;æ¥åšè§†é¢‘æˆªå–èŒƒå›´çš„å¼€å§‹å’Œç»“æŸæŒ‡ç¤ºå™¨ã€‚é¦–å…ˆéœ€è¦å®ç°ä¸‹é¢ç¼©ç•¥å›¾æ’åˆ—ä»¥åŠå®ƒçš„å·¦å³æ»‘åŠ¨ï¼Œé¦–å…ˆéœ€è¦æ‰¾åˆ°æ–¹æ³•è·å–è§†é¢‘çš„å¸§å›¾ç‰‡ã€‚æ‰¾äº†ä¸€ä¸‹èµ„æ–™ï¼Œå¾ˆå¤šï¼ŒåŸºæœ¬éƒ½æ˜¯åŒä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥æš‚æ—¶é€‰å–äº†è¿™ä¸ªæ–¹æ³•ã€‚ä¸ºä½•è¯´æš‚æ—¶ï¼Œåé¢ä¼šè§£é‡Šã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//è·å–æƒ³è¦æ—¶é—´çš„å¸§è§†é¢‘å›¾ç‰‡

+(UIImage *)getCoverImage:(NSURL *)outMovieURL atTime:(CGFloat)time isKeyImage:(BOOL)isKeyImage{

AVURLAsset *asset = [[AVURLAsset alloc] initWithURL:outMovieURL options:nil];

NSParameterAssert(asset);

AVAssetImageGenerator *assetImageGenerator = [[AVAssetImageGenerator alloc] initWithAsset:asset];

assetImageGenerator.appliesPreferredTrackTransform = YES;

assetImageGenerator.apertureMode = AVAssetImageGeneratorApertureModeEncodedPixels;

__block CGImageRef thumbnailImageRef = NULL;

NSError *thumbnailImageGenerationError = nil;

//tips:ä¸‹é¢ä»£ç æ§åˆ¶æ—¶é—´ç‚¹çš„å–å›¾æ˜¯å¦ä¸ºå…³é”®å¸§å›¾ç‰‡ï¼Œç³»ç»Ÿä¸ºäº†æ€§èƒ½æ˜¯é»˜è®¤å–å…³é”®å¸§å›¾ç‰‡

CMTime myTime = CMTimeMake(time, 1);

if (!isKeyImage) {

assetImageGenerator.requestedTimeToleranceAfter = kCMTimeZero;

assetImageGenerator.requestedTimeToleranceBefore = kCMTimeZero;

CMTime duration = asset.duration;

myTime = CMTimeMake(time*30,30);

}

thumbnailImageRef = [assetImageGenerator copyCGImageAtTime:myTime actualTime:NULL error:nil];

if (!thumbnailImageRef){

NSLog(@&quot;thumbnailImageGenerationError %@&quot;, thumbnailImageGenerationError);

}

UIImage *thumbnailImage = thumbnailImageRef ? [[UIImage alloc]

initWithCGImage:thumbnailImageRef] : nil;

CGImageRelease(thumbnailImageRef);

return thumbnailImage;

}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;é€šå¸¸å¼€å‘è€…è®¤ä¸ºæ—¶é—´çš„å‘ˆç°æ ¼å¼åº”è¯¥æ˜¯æµ®ç‚¹æ•°æ®ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;NSTimeInterval&lt;/code&gt;ï¼Œå®é™…ä¸Šå®ƒæ˜¯ç®€å•çš„åŒç²¾åº¦&lt;code class=&quot;highlighter-rouge&quot;&gt;double&lt;/code&gt;ç±»å‹ï¼Œåªæ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;typedef&lt;/code&gt;äº†ä¸€ä¸‹ï¼Œä½†æ˜¯ç”±äºæµ®ç‚¹å‹æ•°æ®è®¡ç®—å¾ˆå®¹æ˜“å¯¼è‡´ç²¾åº¦çš„ä¸¢å¤±ï¼Œåœ¨ä¸€äº›è¦æ±‚é«˜ç²¾åº¦çš„åº”ç”¨åœºæ™¯æ˜¾ç„¶ä¸é€‚åˆï¼Œäºæ˜¯è‹¹æœåœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;Core Media&lt;/code&gt;æ¡†æ¶ä¸­å®šä¹‰äº†&lt;code class=&quot;highlighter-rouge&quot;&gt;CMTime&lt;/code&gt;æ•°æ®ç±»å‹ä½œä¸ºæ—¶é—´çš„æ ¼å¼&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;typedef struct{

	CMTimeValue    value;
	
	CMTimeScale    timescale;
	
	CMTimeFlags    flags;
	
	CMTimeEpoch    epoch;

} CMTime;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;æ˜¾ç„¶ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;CMTime&lt;/code&gt;å®šä¹‰æ˜¯ä¸€ä¸ªCè¯­è¨€çš„ç»“æ„ä½“ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;CMTime&lt;/code&gt;æ˜¯ä»¥åˆ†æ•°çš„å½¢å¼è¡¨ç¤ºæ—¶é—´ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;value&lt;/code&gt;è¡¨ç¤ºåˆ†å­ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;timescale&lt;/code&gt;è¡¨ç¤ºåˆ†æ¯ï¼Œ&lt;code class=&quot;highlighter-rouge&quot;&gt;flags&lt;/code&gt;æ˜¯ä½æ©ç ï¼Œè¡¨ç¤ºæ—¶é—´çš„æŒ‡å®šçŠ¶æ€ã€‚&lt;code class=&quot;highlighter-rouge&quot;&gt;CMTimeMake(3, 1)&lt;/code&gt;ç»“æœä¸º3ã€‚
æˆ‘æ˜¯é»˜è®¤ä¸€ä¸ªå®Œæ•´å±å¹•å®½åº¦ä¸º15ç§’çš„æˆªå–é•¿åº¦ï¼Œåœ¨è§†é¢‘çš„æ¯ç§’å–ä¸€å¼ å¸§å›¾ç‰‡ä½œä¸ºåº•éƒ¨é¢„è§ˆå°å›¾ï¼Œèµ·åˆæˆ‘æ˜¯ç”¨å¾ªç¯è§†é¢‘æ—¶é•¿ç§’æ•°ï¼Œæ¯æ¬¡ç”¨ä¸Šé¢æ–¹æ³•å–ä¸€å¼ å›¾ç‰‡ï¼Œå†ç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;UIImageView&lt;/code&gt;æ”¾ç½®è¿™å¼ å›¾ç‰‡ï¼Œæœ€åå†è®¡ç®—&lt;code class=&quot;highlighter-rouge&quot;&gt;imageView&lt;/code&gt;çš„ä½ç½®æ·»åŠ åˆ°&lt;code class=&quot;highlighter-rouge&quot;&gt;scrollView&lt;/code&gt;ä¸Šã€‚ç»“æœè¿™æ˜¯ä¸€ä¸ªå‘ï¼Œè§†é¢‘åªæœ‰äºŒä¸‰åç§’è¿˜å¥½ï¼Œå¦‚æœæ¯”è¾ƒé•¿åˆ™ä¼šåˆ›å»ºå¾ˆå¤šä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;imageView&lt;/code&gt;ï¼Œå†…å­˜æš´æ¶¨ï¼Œå¯¼è‡´å¡é¡¿æˆ–è€…ç›´æ¥crashã€‚åæ¥æƒ³åˆ°äº†ç»˜å›¾ï¼Œè¿™æ ·å°±ä¸ä¼šè¯·æ±‚å†…å­˜å¤šæ¬¡åˆ†é…ç©ºé—´ï¼Œä»è€Œè§£å†³å†…å­˜æš´æ¶¨é—®é¢˜ã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;WZScrollView&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;UIScrollView&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nonatomic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strong&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UIImage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@property&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nonatomic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;assign&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;drawImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIImage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;image&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;inRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;rect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@end&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;WZScrollView&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;drawRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;rect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

	&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;drawRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
	
	&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_image&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;drawInRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;drawImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIImage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;image&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;inRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;rect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

	&lt;span class=&quot;n&quot;&gt;_image&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	
	&lt;span class=&quot;n&quot;&gt;_rect&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rect&lt;/span&gt;
	
	&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setNeedsDisplayInRect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;ç»“æœå‘ç°ç›´æ¥ç”»å›¾åˆ°&lt;code class=&quot;highlighter-rouge&quot;&gt;scrollView&lt;/code&gt;ä¸Šåï¼Œåœ¨ä½ æ‹–åŠ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;scrollView&lt;/code&gt;çš„æ—¶å€™å®ƒå§‹ç»ˆä¼šåªæ˜¾ç¤ºå‰é¢15å¼ å›¾ç‰‡çš„æ•ˆæœï¼Œo(â•¯â–¡â•°)oï¼ï¼ï¼æµ‹è¯•äº†ä¸€ä¸‹ï¼Œæ»šåŠ¨æ˜¯æœ‰æ•ˆæœçš„ï¼Œä½†æ˜¯ä½“éªŒä¸å¥½å•Šã€‚åæ¥æŠŠä¸Šé¢çš„ç»§æ‰¿ç±»ä»&lt;code class=&quot;highlighter-rouge&quot;&gt;UIScrollView&lt;/code&gt;æ”¹æˆäº†&lt;code class=&quot;highlighter-rouge&quot;&gt;UIView&lt;/code&gt;ï¼ŒæŠŠå›¾ç‰‡ç»˜åˆ¶åˆ°&lt;code class=&quot;highlighter-rouge&quot;&gt;view&lt;/code&gt;ä¸Šå†åŠ åˆ°&lt;code class=&quot;highlighter-rouge&quot;&gt;scrollView&lt;/code&gt;ä¸Šï¼Œè®¾ç½®å¥½&lt;code class=&quot;highlighter-rouge&quot;&gt;contentSize&lt;/code&gt;ï¼Œé—®é¢˜è§£å†³ã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;@interface WZScrollView : UIView
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;æ¥ä¸‹æ¥å°±æ˜¯å·¦å³å¼€å§‹å’Œç»“æŸçš„æŒ‡ç¤ºå›¾ç‰‡äº†ï¼Œç”±äºå›¾ç‰‡å¤ªå°ä¼šæœ‰å¯èƒ½æ¥æ”¶ä¸åˆ°ç‚¹å‡»äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œçš„åˆ‡å›¾åœ¨å¼€å§‹å¤„æŒ‡ç¤ºå›¾ç‰‡çš„å³è¾¹å’Œç»“æŸæŒ‡ç¤ºå›¾ç‰‡çš„å·¦è¾¹å¤šè£ä¸€éƒ¨åˆ†é€æ˜èŒƒå›´ï¼Œè¿™æ ·æŒ‡ç¤ºå™¨çš„é¢ç§¯å°±æ¯”ä½ çœ‹åˆ°çš„å¤§äº†ï¼Œæ–¹ä¾¿æ“ä½œã€‚æ¥ä¸‹æ¥å°±æ˜¯å®ƒä»¬çš„æ‹–åŠ¨æ“ä½œï¼Œæœ€å¼€å§‹æˆ‘ä½¿ç”¨çš„æ˜¯viewçš„&lt;code class=&quot;highlighter-rouge&quot;&gt;touchesMovedï¼šwithEvent:&lt;/code&gt;æ¥è®©å›¾ç‰‡æ”¹å˜xå€¼ä»è€Œè·Ÿéšæ‰‹æŒ‡ç§»åŠ¨ã€‚ç»“æœå‘ç°ï¼Œæ‰‹é€Ÿç¨å¿«æˆ–è€…è§¦ç‚¹ç¨å¾®åç§»å°±ä¼šå¯¼è‡´å›¾ç‰‡ä½ç½®æ”¹å˜åœæ­¢ï¼Œä½“éªŒå’Œæ€§èƒ½éƒ½ä¸è¡Œã€‚åæ¥æ”¹ç”¨æ‹–åŠ¨æ‰‹åŠ¿&lt;code class=&quot;highlighter-rouge&quot;&gt;UIPanGestureRecognizer&lt;/code&gt;å°±å®Œç¾è§£å†³äº†æ­¤é—®é¢˜ï¼Œè¿™é‡Œä»£ç å¤šæ˜¯é€»è¾‘å¤„ç†é—®é¢˜ï¼ŒåŒ…æ‹¬æ‹–åŠ¨èŒƒå›´ä½•æ—¶ä¼šè®©ç›¸åº”å›¾ç‰‡è¿›è¡Œä½ç½®æ”¹å˜çš„å“åº”ï¼Œä¸Šä¸‹çš„ç™½è‰²çº¿æ¡ä½ç½®å’Œé•¿åº¦æ”¹å˜ç­‰ç­‰ã€‚ä½†è¿™é‡Œéœ€è¦æ³¨æ„ä¸‰ä¸ªé—®é¢˜ï¼ša.æ‹–åŠ¨æ‰‹åŠ¿çš„å›è°ƒæ–¹æ³•é‡Œé¢çš„æ”¹å˜è·ç¦»å’ŒåŸè§†å›¾ä½ç½®çš„xå€¼ä¼šæŒ‡æ•°ç›¸åŠ ï¼Œæ¯æ¬¡å›è°ƒéƒ½åº”è¯¥å°†è§†å›¾çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;translation&lt;/code&gt;ç½®0ã€‚b.éœ€è¦æ¯æ¬¡å›è°ƒéƒ½è®¡ç®—å¼€å§‹å’Œç»“æŸä½ç½®çš„æ—¶é—´ç‚¹ï¼Œè®©å…¶æœ‰å®æ—¶æ€§ã€‚c.æ‹–åŠ¨ç»“æŸæ—¶éœ€è¦è®©æ’­æ”¾å™¨å¾ªç¯æ’­æ”¾ä¸¤ä¸ªæ—¶é—´ç‚¹é—´çš„è§†é¢‘å†…å®¹ã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-(void)panAction:(UIPanGestureRecognizer *)panGR{

//ä¼ªä»£ç ï¼šæ ¹æ®éœ€æ±‚æ”¹å˜å¼€å§‹å’Œç»“æŸæŒ‡ç¤ºå›¾ç‰‡çš„ä½ç½®

if(panGR.state == UIGestureRecognizerStateChanged){

[panGR setTranslation:CGPointZero inView:self.superview];

}

[self calculateForTimeNodes];//å®æ—¶è®¡ç®—è£å‰ªæ—¶é—´

if (panGR.state == UIGestureRecognizerStateEnded) {

//ä¼ªä»£ç ï¼šæŒ‡ç¤ºæ’­æ”¾å™¨æ’­æ”¾ç›¸åº”è§†é¢‘ç‰‡æ®µä»£ç 

}
//è®¡ç®—å¼€å§‹ç»“æŸæ—¶é—´ç‚¹

-(void)calculateForTimeNodes{

CGPoint offset = _scrollView.contentOffset;

_startTime =(offset.x+self.startView.frame.origin.x)*15*1.0f/self.bounds.size.width;

_endTime = (offset.x + self.endView.frame.origin.x + KendTimeButtonWidth) * 15 * 1.0f/self.bounds.size.width;

CGFloat imageTime = _startTime;//é¢„è§ˆæ—¶é—´ç‚¹

if (_chooseType == imageTypeEnd) {

imageTime = _endTime;

}

if (self.getTimeRange) {

self.getTimeRange(_startTime,_endTime,imageTime);//æ§åˆ¶é¢„è§ˆæ’­æ”¾ç•Œé¢çš„å½“å‰ç”»é¢ï¼ˆè¿™é‡Œæ˜¯ä¸€ä¸ªæ’­æ”¾é¡µä¼ è¿‡æ¥çš„blockçš„è°ƒç”¨ï¼‰

}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;2.æ‹–åŠ¨scrollViewæ—¶ï¼Œé»˜è®¤æ˜¯å±•ç¤ºå¼€å§‹æ—¶é—´ç‚¹çš„è§†é¢‘å¸§ç”»é¢ï¼Œåœ¨&lt;code class=&quot;highlighter-rouge&quot;&gt;scrollViewDidScroll:&lt;/code&gt;æ–¹æ³•ä¸­è°ƒç”¨&lt;code class=&quot;highlighter-rouge&quot;&gt;calculateForTimeNodes&lt;/code&gt;æ–¹æ³•å³å¯å®æ—¶æ›´æ–°å¼€å§‹ã€ç»“æŸå’Œé¢„è§ˆ3ä¸ªæ—¶é—´ç‚¹å‚æ•°ï¼Œè¿™ä¸€æ­¥çš„å¾ˆå¤šé€»è¾‘éƒ½å°è£…åˆ°ç¬¬ä¸€æ­¥çš„ä¸€äº›æ–¹æ³•ä¸­äº†ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥æ¯”è¾ƒç®€å•ã€‚&lt;/p&gt;

&lt;p&gt;3.æ‹–åŠ¨æ—¶æš‚åœæ’­æ”¾ï¼Œæ¾æ‰‹åæ’­æ”¾ç›¸åº”æ—¶é—´èŒƒå›´è§†é¢‘å†…å®¹ï¼Œå¯ä»¥å¾ªç¯æ’­æ”¾ã€‚å…³äºå¼€å§‹å’Œç»“æŸæŒ‡ç¤ºå›¾ç‰‡çš„æ‹–åŠ¨çŠ¶æ€å¯ä»¥ç”¨ä¸Šé¢æåˆ°çš„&lt;code class=&quot;highlighter-rouge&quot;&gt;panGR.state == UIGestureRecognizerStateEnded&lt;/code&gt;æ¥åˆ¤æ–­ï¼Œè¿›å…¥åˆ¤æ–­è¯´æ˜æ¾æ‰‹äº†ï¼Œæ²¡æœ‰åˆ™è¿˜åœ¨æ‹–åŠ¨ã€‚è€ŒscrollViewçš„æ‹–åŠ¨å’Œåœæ­¢ç›´æ¥è°ƒç”¨å®ƒçš„ä»£ç†å°±è¡Œäº†ï¼Œè¿™é‡Œä¸èµ˜è¿°ï¼Œä¸æ˜ç™½å¯ä»¥åœ¨demoé‡Œé¢æŸ¥çœ‹ã€‚è¿™é‡Œé‡åˆ°ä¸ªå‘æ˜¯å› ä¸ºå‰é¢åœ¨è§†é¢‘é¢„è§ˆé¡µé¢æ‹–åŠ¨çš„æ—¶å€™éœ€è¦æœ‰å½“å‰çš„è§†é¢‘å¸§ç”»é¢ç”¨ä½œé¢„è§ˆï¼Œè€Œå¼€å§‹æ˜¯&lt;code class=&quot;highlighter-rouge&quot;&gt;getCoverImage: atTime: isKeyImage:&lt;/code&gt;è¿™ä¸ªæ–¹æ³•æ¥è·å–å¸§å›¾ç‰‡çš„ï¼Œå½“æ‹–åŠ¨æ—¶å°±æ˜¾ç¤ºå›¾ç‰‡å›¾å±‚ï¼Œåœæ­¢æ‹–åŠ¨å°±éšè—å›¾ç‰‡å›¾å±‚ï¼Œè¿›è€Œæ˜¾ç¤ºä¸‹é¢çš„è§†é¢‘å›¾å±‚ã€‚ç»“æœè¿™ä¸ªæ–¹æ³•æ¯”è¾ƒæ¶ˆè€—cpuï¼Œä¼šå¯¼è‡´å¡é¡¿æƒ…å†µï¼Œè¿˜ä¼šç»å¸¸å› ä¸ºcpuè¿‡é«˜ç›´æ¥crashã€‚åæ¥å‘ç°AVPlayeré‡Œé¢æœ‰ä¸€ä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;seekToTime: toleranceBefore: toleranceAfter: completionHandler:&lt;/code&gt;æ–¹æ³•ï¼Œä½œç”¨æ˜¯è®©è§†é¢‘è·³åˆ°æŸä¸ªæ—¶é—´ç‚¹å¼€å§‹æ’­æ”¾ã€‚æˆ‘å»,è¿™ä¹ˆç®€å•æˆ‘å´é¥¶äº†å¥½å¤§ä¸€ä¸ªå¼¯ï¼Œæ‰€ä»¥å¤§å®¶ä¸€å®šè¦åœ¨ä½¿ç”¨ç±»çš„æ—¶å€™è¦å…»æˆå¤šçœ‹åŸç±»æ–‡ä»¶çš„å¥½ä¹ æƒ¯ï¼Œå¯ä»¥å°‘è·³æŠ—ï¼Œå›§ï¼ï¼ï¼å…¶å®AVPlayerè¿˜æœ‰ä¸€ä¸ª&lt;code class=&quot;highlighter-rouge&quot;&gt;seekToTime:&lt;/code&gt;æ–¹æ³•,æˆ‘ä¸ä½¿ç”¨å®ƒçš„åŸå› æ˜¯å®ƒæœ‰ä¸€ä¸ªè‡ªå·±çš„æœ€å°æ—¶é—´å•ä½ï¼ˆè²Œä¼¼æ˜¯å…³é”®å¸§ï¼‰ï¼Œç”¨å®ƒä¸ä¼šå®æ—¶æ”¹å˜æ’­æ”¾å™¨ç”»é¢ã€‚&lt;/p&gt;

&lt;p&gt;è§†é¢‘æ‹–åŠ¨æ—¶ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[_player pause];

[_player seekToTime:CMTimeMake(time*30, 30) toleranceBefore:kCMTimeZero toleranceAfter:kCMTimeZero completionHandler:^(BOOL finished) {

}];
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;æ‹–åŠ¨åœæ­¢æ—¶ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[_player seekToTime:CMTimeMake(_startTime*30, 30) toleranceBefore:kCMTimeZero toleranceAfter:kCMTimeZero completionHandler:^(BOOL finished) {

[_player play];

}];
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;4.æœ€åå°±æ˜¯å¯¹è§†é¢‘è¿›è¡Œè£å‰ªäº†ï¼Œè¿™é‡Œçš„è¿™ä¸ªæ–¹æ³•ä¸æ˜¯æˆ‘å†™çš„ï¼Œæ˜¯ç½‘ä¸Šæ‰¾çš„åˆ«äººçš„ä»£ç ï¼Œä½†æ˜¯åŸä»£ç æœ‰ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯è¾“å‡ºçš„è§†é¢‘æ–‡ä»¶æ–¹å‘æ”¹å˜äº†ã€‚åœ¨è¿™é‡Œæˆ‘ç”¨äº†ä¸‹é¢3è¡Œä»£ç æ¥ä¿è¯è¾“å‡ºè§†é¢‘çš„æ–¹å‘è·ŸåŸè§†é¢‘ä¿æŒä¸€è‡´&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;AVURLAsset *asset = [AVURLAsset assetWithURL:videoUrl];

AVAssetTrack *assetVideoTrack = [[asset tracksWithMediaType:AVMediaTypeVideo]firstObject];

[compositionVideoTrack setPreferredTransform:assetVideoTrack.preferredTransform];
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;æˆ‘è¿™é‡Œè§†é¢‘è£å‰ªåçš„è¾“å‡ºè§†é¢‘è·¯å¾„æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘å°è£…çš„æ–¹æ³•é‡Œé¢çš„å›è°ƒæ˜¯æ²¡æœ‰å‚æ•°çš„ï¼Œç å‹å¦‚æœéœ€è¦å¯ä»¥è‡ªè¡Œæ”¹è£…ï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;+ (void)addBackgroundMiusicWithVideoUrlStr:(NSURL *)videoUrl audioUrl:(NSURL *)audioUrl andCaptureVideoWithRange:(TimeRange)videoRange completion:(void(^)(void))completionHandleï¼›
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;å¤§å®¶å¦‚æœä¸‹demoæ¥çœ‹çš„è¯ä¼šå‘ç°æˆ‘åœ¨è¿™ä¸ªæ–¹æ³•è°ƒç”¨æ—¶åœ¨å›è°ƒé‡Œé¢å¤šåŠ äº†ä¸€ä¸ªä¿å­˜è§†é¢‘æ–¹æ³•åˆ°é‡Œé¢ï¼Œæ˜¯ç”±äºæˆ‘çš„é¡¹ç›®éœ€æ±‚ã€‚è¿™ä¸ªæ–¹æ³•ä¼šæ–°å»ºä¸€ä¸ªä»¥é¡¹ç›®åç§°å‘½åçš„ç›¸å†Œï¼Œç”¨æ¥å­˜æ”¾å‰ªåˆ‡åçš„è§†é¢‘ï¼Œå›è°ƒä¼šä¼ å›ä¸€ä¸ªPHAssetå¯¹è±¡ï¼ˆé¡¹ç›®éœ€æ±‚ï¼‰ï¼Œè¿™ä¸ªå°±æ˜¯èµ é€èŠ‚ç›®äº†ğŸ˜ã€‚&lt;/p&gt;

&lt;p&gt;è¿™é‡Œæ˜¯&lt;a href=&quot;https://github.com/JoshPellTan/TJVideoCutDemo&quot;&gt;demo&lt;/a&gt;ä¸‹è½½åœ°å€ï¼Œå¦‚æœå¯¹ä½ æœ‰ç”¨çš„è¯åˆ«å¿˜äº†starä¸€ä¸ªğŸ˜ã€‚&lt;/p&gt;

&lt;p&gt;å¥½ä¹…æ²¡åŠ¨swiftäº†ï¼Œæœ¬æ¥æƒ³å†™ä¸€ä¸ªswiftç‰ˆç»ƒä¸€ç»ƒï¼Œåé¢å†è¯´å§å“ˆå“ˆã€‚ã€‚ã€‚&lt;/p&gt;
</description>
        <pubDate>Tue, 07 Mar 2017 16:08:13 +0800</pubDate>
        <link>/2017/03/%E4%BB%BF%E5%BE%AE%E4%BF%A1%E6%9C%8B%E5%8F%8B%E5%9C%88%E8%A7%86%E9%A2%91%E5%89%AA%E5%88%87%E5%8A%9F%E8%83%BD/</link>
        <guid isPermaLink="true">/2017/03/%E4%BB%BF%E5%BE%AE%E4%BF%A1%E6%9C%8B%E5%8F%8B%E5%9C%88%E8%A7%86%E9%A2%91%E5%89%AA%E5%88%87%E5%8A%9F%E8%83%BD/</guid>
        
        <category>è§†é¢‘</category>
        
        <category>å‰ªåˆ‡</category>
        
        <category>å¾®ä¿¡</category>
        
        <category>ä»¿å¾®ä¿¡æœ‹å‹åœˆè§†é¢‘å‰ªåˆ‡åŠŸèƒ½</category>
        
        
        <category>study</category>
        
      </item>
    
      <item>
        <title>å…³äºä¿®æ”¹ç³»ç»Ÿè‡ªå¸¦çš„å¯¼èˆªæ </title>
        <description>&lt;p&gt;ä»Šå¤©é‡åˆ°äº†ä¸€ä¸ªè¿™æ ·çš„éœ€æ±‚ï¼Œéœ€è¦åœ¨å¯¼èˆªæ åŠ ä¸ŠsearchBarã€‚ä½†æˆ‘ç›´æ¥åŠ ä¸Šä¹‹åå‡ºç°äº†è¿™ç§æƒ…å†µï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.yupoo.com/joshpell/Gdhltvrh/QmhKB.png&quot; width=&quot;400&quot; height=&quot;60&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è‡ªå·±å®šä¹‰çš„è¿”å›æŒ‰é’®è·ç¦»å·¦è¾¹å¤ªè¿œï¼Œè§†è§‰æ•ˆæœä¸å¥½ï¼Œä½†æˆ‘æ— è®ºæ€ä¹ˆè°ƒæ•´è¿™ä¸ªbuttonçš„frameéƒ½è§£å†³ä¸äº†é—®é¢˜ï¼Œåæ¥æ‰¾åˆ°äº†è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//è®¾ç½®å¯¼èˆªæ ï¼Œå¹¶è°ƒæ•´è‡ªå®šä¹‰è¿”å›æŒ‰é’®çš„ä½ç½®å’Œå¤§å°
UIBarButtonItem * spaceItem = [[UIBarButtonItem alloc]initWithBarButtonSystemItem:UIBarButtonSystemItemFixedSpace target:nil action:nil];
UIBarButtonItem * backItem = [[UIBarButtonItem alloc]initWithCustomView: self.backBtn];
//å°†å®½åº¦è®¾ä¸ºè´Ÿå€¼ï¼Œå¦åˆ™è¿”å›æŒ‰é’®ä¼šå¾ˆå®½
spaceItem.width = -15;
self.navigationItem.leftBarButtonItems = @[spaceItem,backItem];
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;è·‘ä»£ç æµ‹è¯•ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://pic.yupoo.com/joshpell/GdhltzI1/vgqjY.png&quot; width=&quot;400&quot; height=&quot;60&quot; alt=&quot;photos&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å®Œç¾ï¼&lt;/p&gt;

</description>
        <pubDate>Thu, 09 Feb 2017 16:08:13 +0800</pubDate>
        <link>/2017/02/%E5%85%B3%E4%BA%8E%E4%BF%AE%E6%94%B9%E7%B3%BB%E7%BB%9F%E8%87%AA%E5%B8%A6%E7%9A%84%E5%AF%BC%E8%88%AA%E6%A0%8F/</link>
        <guid isPermaLink="true">/2017/02/%E5%85%B3%E4%BA%8E%E4%BF%AE%E6%94%B9%E7%B3%BB%E7%BB%9F%E8%87%AA%E5%B8%A6%E7%9A%84%E5%AF%BC%E8%88%AA%E6%A0%8F/</guid>
        
        <category>å¯¼èˆªæ </category>
        
        <category>å…³äºä¿®æ”¹ç³»ç»Ÿè‡ªå¸¦çš„å¯¼èˆªæ </category>
        
        
        <category>tips</category>
        
      </item>
    
  </channel>
</rss>
